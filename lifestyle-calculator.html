`<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Lifestyle Calculator: What Your Family's Income Really Buys</title>
    <meta
        content="Explore how different family income levels translate to real lifestyle choices. From $20K to $25M+, see what your household can afford: dining, travel, housing, entertainment, education, financial planning, and luxury services with this interactive tool. Includes a basic Cost of Living Adjustment."
        name="description" />
    <meta
        content="lifestyle calculator, income lifestyle, family budget, what can I afford, salary lifestyle, income comparison, lifestyle expenses, luxury calculator, income brackets, wealth lifestyle, finance, cost of living, financial planning, investments, family finance"
        name="keywords" />
    <link href="https://cheatsheets.davidveksler.com/lifestyle-calculator.html" rel="canonical" />
    <!-- Open Graph / Facebook -->
    <meta content="website" property="og:type" />
    <meta content="https://cheatsheets.davidveksler.com/lifestyle-calculator.html" property="og:url" />
    <meta content="Lifestyle Calculator: What Your Family's Income Really Buys" property="og:title" />
    <meta
        content="Explore how different family income levels translate to real lifestyle choices, with a basic Cost of Living Adjustment. See what your household can afford from $20K to $25M+."
        property="og:description" />
    <meta content="images/lifestyle-calculator.png" property="og:image" />
    <meta content="Interactive lifestyle calculator showing income to lifestyle progression " property="og:image:alt" />
    <meta content="1200" property="og:image:width" />
    <meta content="630" property="og:image:height" />
    <!-- Twitter Card -->
    <meta content="summary_large_image" name="twitter:card" />
    <meta content="https://cheatsheets.davidveksler.com/lifestyle-calculator.html" name="twitter:url" />
    <meta content="Lifestyle Calculator: What Your Family's Income Really Buys" name="twitter:title" />
    <meta
        content="Explore how different family income levels translate to real lifestyle choices, with a basic Cost of Living Adjustment. See what your household can afford from $20K to $25M+."
        name="twitter:description" />
    <meta content="images/lifestyle-calculator.png" name="twitter:image" />

    <!-- SEO: JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Lifestyle Calculator: What Your Family's Income Really Buys",
      "description": "An interactive tool to explore how family income levels from $20K to $25M+ translate to real-world lifestyle choices in housing, dining, travel, and more, with cost of living adjustments.",
      "applicationCategory": "FinanceApplication",
      "operatingSystem": "All",
      "browserRequirements": "Requires a modern web browser with JavaScript enabled.",
      "url": "https://cheatsheets.davidveksler.com/lifestyle-calculator.html",
      "creator": {
        "@type": "Person",
        "name": "David Veksler"
      },
      "keywords": "lifestyle calculator, income lifestyle, family budget, what can I afford, salary lifestyle, finance, cost of living, financial planning"
    }
    </script>

    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto+Slab:wght@700&display=swap"
        rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #0d6efd;
            --primary-color-rgb: 13, 110, 253;
            --secondary-color: #6c757d;
            --success-color: #198754;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #0dcaf0;
            --dark-color: #212529; /* Main text color */
            --light-color: #f8f9fa; /* Light element backgrounds */

            --body-bg-color: #e9ecef;
            --main-container-bg: rgba(255, 255, 255, 0.98);
            --main-container-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
            --card-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            --border-radius: 0.75rem;

            --page-title-font-family: 'Roboto Slab', serif;
            --page-title-color: var(--primary-color);
            --page-title-letter-spacing: normal;
            --page-title-text-transform: none;
            --page-title-font-weight: 700;

            --category-title-font-family: 'Roboto Slab', serif;
            --category-title-letter-spacing: normal;
            --category-title-text-transform: none;
            --category-title-font-weight: 700;

            --category-icon-opacity: 0.8;
            --item-title-font-weight: 600;
            --item-description-color: #495057;
            --category-item-border-color: #dee2e6;

            --slider-thumb-bg: var(--primary-color);
            --slider-thumb-border: 5px solid white;
            --slider-thumb-shadow-opacity: 0.5;

            --calculator-note-bg: #fff3cd;
            --calculator-note-border: #ffeeba;
            --calculator-note-text: var(--dark-color);

            --income-bracket-desc-color: #495057;
            --chart-legend-text-color: #495057;


            /* Refined Badge Colors */
            --badge-budgetSmart-bg: #e0f2f1; /* Teal light */
            --badge-budgetSmart-text: #00796b; /* Teal dark */
            --badge-milestone-bg: #e3f2fd;   /* Blue light */
            --badge-milestone-text: #1565c0;  /* Blue dark */
            --badge-essential-bg: #e8eaed;   /* Muted Grey-Blue light */
            --badge-essential-text: #5f6368;  /* Muted Grey-Blue dark */
            --badge-premium-bg: #fff8e1;     /* Yellow light */
            --badge-premium-text: #f57f17;    /* Yellow/Orange dark */
            --badge-ultraPremium-bg: #f3e5f5; /* Purple light */
            --badge-ultraPremium-text: #6a1b9a; /* Purple dark */
            --badge-aspirational-bg: #e8f5e9; /* Green light */
            --badge-aspirational-text: #2e7d32;  /* Green dark */
            --badge-convenience-bg: #f1f8e9;  /* Light Green light */
            --badge-convenience-text: #558b2f; /* Light Green dark */
            --badge-statusSymbol-bg: #311b92;  /* Deep rich purple */
            --badge-statusSymbol-text: #ffca28; /* Amber/Gold */
        }

        body {
            font-family: 'Inter', sans-serif;
            padding: 2rem 0;
            color: var(--dark-color);
            background-color: var(--body-bg-color);
            transition: background-color 1.2s ease-in-out, color 1.2s ease-in-out;
        }

        .background-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
        }

        #background-layer-1,
        #background-layer-2 {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: opacity 1.2s ease-in-out, background 1.2s ease-in-out;
            opacity: 0;
            z-index: -1;
        }

        .theme-basic { background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); }
        .theme-comfortable { background: linear-gradient(135deg, #e0fbfc 0%, #c2f0fc 100%); }
        .theme-affluent { background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%); }
        .theme-luxury { background: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 100%); }
        .theme-ultra { background: linear-gradient(135deg, #ede7f6 0%, #d1c4e9 100%); }
        .theme-elite { background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); }

        /* HNW and UHNW specific backgrounds */
        .theme-hnw-bg { background: linear-gradient(135deg, #FDF5E6 0%, #DAA520 100%); }
        .theme-uhnw-bg { background: linear-gradient(135deg, #1a1a1a 0%, #003366 70%, #00A9E0 100%); }


        .main-container {
            background: var(--main-container-bg);
            backdrop-filter: blur(5px);
            border-radius: var(--border-radius);
            box-shadow: var(--main-container-shadow);
            padding: 2.5rem;
            margin-bottom: 2rem;
            transition: background-color 1.2s ease-in-out, box-shadow 1.2s ease-in-out;
        }

        .page-title {
            font-family: var(--page-title-font-family);
            font-size: 2.6rem;
            font-weight: var(--page-title-font-weight);
            color: var(--page-title-color);
            margin-bottom: 0.25rem;
            letter-spacing: var(--page-title-letter-spacing);
            text-transform: var(--page-title-text-transform);
            transition: color 1.2s ease-in-out, letter-spacing 0.5s ease, text-transform 0.5s ease;
        }

        body.uhnw-theme-active .page-title {
            letter-spacing: 1.5px;
            text-transform: uppercase;
            font-weight: 600; /* Slightly thinner for uppercase */
             text-shadow: 0 0 8px rgba(var(--primary-color-rgb), 0.7);
        }
        body.hnw-theme-active .page-title {
            text-shadow: 0 0 5px rgba(var(--primary-color-rgb), 0.5);
        }


        .page-subtitle {
            font-size: 1.0rem;
            color: var(--secondary-color);
            margin-bottom: 0.5rem;
            transition: color 1.2s ease-in-out;
        }

        .calculator-note {
            font-size: 0.9rem;
            color: var(--calculator-note-text);
            font-style: normal;
            font-weight: 500;
            background-color: var(--calculator-note-bg);
            border: 1px solid var(--calculator-note-border);
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            margin-bottom: 1.5rem;
            text-align: center;
            transition: background-color 1.2s ease-in-out, color 1.2s ease-in-out, border-color 1.2s ease-in-out;
        }

        .controls-container {
            background: var(--light-color);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid var(--category-item-border-color); /* Re-use for consistency */
            transition: background-color 1.2s ease-in-out, border-color 1.2s ease-in-out;
        }

        .form-label {
            font-weight: 500;
            margin-bottom: 0.3rem;
            font-size: 0.9rem;
            color: var(--dark-color); /* Ensures it inherits themed text color */
            transition: color 1.2s ease-in-out;
        }

        .form-select-sm {
            font-size: 0.875rem;
            padding-top: 0.4rem;
            padding-bottom: 0.4rem;
        }

        .income-display {
            font-family: 'Roboto Slab', serif;
            font-size: 2.3rem;
            font-weight: 700;
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 0.1rem;
            transition: color 1.2s ease-in-out;
        }
         body.uhnw-theme-active .income-display {
             text-shadow: 0 0 10px rgba(var(--primary-color-rgb), 0.8);
        }
        body.hnw-theme-active .income-display {
             text-shadow: 0 0 8px rgba(var(--primary-color-rgb), 0.6);
        }


        .effective-income-display {
            font-size: 0.95rem;
            color: var(--secondary-color);
            text-align: center;
            margin-bottom: 0.25rem;
            font-style: italic;
            min-height: 20px;
            transition: color 1.2s ease-in-out;
        }

        .income-bracket-label {
            font-size: 1.3rem;
            color: var(--dark-color);
            text-align: center;
            font-weight: 600;
            margin-bottom: 0.25rem;
            transition: color 1.2s ease-in-out;
        }

        .income-bracket-description {
            font-size: 0.9rem;
            color: var(--income-bracket-desc-color);
            text-align: center;
            font-weight: 400;
            margin-bottom: 1.5rem;
            min-height: 38px;
            line-height: 1.4;
            transition: color 1.2s ease-in-out;
        }

        .slider {
            width: 100%;
            height: 12px;
            border-radius: 6px;
            background: #dee2e6;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            margin-bottom: 0.5rem;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--slider-thumb-bg);
            cursor: pointer;
            border: var(--slider-thumb-border);
            box-shadow: 0 3px 8px rgba(var(--primary-color-rgb), var(--slider-thumb-shadow-opacity));
            transition: background-color 0.3s ease-in-out, border-color 0.3s ease-in-out;
        }

        .slider::-moz-range-thumb {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--slider-thumb-bg);
            cursor: pointer;
            border: var(--slider-thumb-border);
            box-shadow: 0 3px 8px rgba(var(--primary-color-rgb), var(--slider-thumb-shadow-opacity));
            transition: background-color 0.3s ease-in-out, border-color 0.3s ease-in-out;
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--secondary-color); /* Changed from #6c757d */
            padding: 0 5px;
            transition: color 1.2s ease-in-out;
        }

        .lifestyle-category {
            background: #ffffff; /* Default, might be overridden by --light-color in some themes */
            border-radius: var(--border-radius);
            padding: 1.75rem;
            margin-bottom: 1.75rem;
            border-left: 6px solid var(--primary-color);
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
        }
        body.uhnw-theme-active .lifestyle-category {
            background: var(--light-color); /* Will be darkish gray */
        }


        .lifestyle-category:hover {
            transform: translateY(-4px) scale(1.015);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.1);
        }
        body.hnw-theme-active .lifestyle-category:hover, body.uhnw-theme-active .lifestyle-category:hover {
             box-shadow: 0 12px 35px rgba(var(--primary-color-rgb), 0.3);
        }


        .category-title {
            font-family: var(--category-title-font-family);
            font-size: 1.5rem;
            font-weight: var(--category-title-font-weight);
            color: var(--dark-color);
            margin-bottom: 1.25rem;
            display: flex;
            align-items: center;
            gap: 0.85rem;
            letter-spacing: var(--category-title-letter-spacing);
            text-transform: var(--category-title-text-transform);
            transition: color 1.2s ease-in-out, letter-spacing 0.5s ease, text-transform 0.5s ease;
        }
        body.uhnw-theme-active .category-title {
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }


        .category-icon {
            font-size: 2rem;
            color: var(--primary-color);
            opacity: var(--category-icon-opacity);
            transition: color 1.2s ease-in-out, opacity 1.2s ease-in-out;
        }

        .category-item-icon {
            font-size: 1.6rem;
            color: var(--primary-color); /* Will be overridden by category specific color */
            opacity: 0.75; /* Keep this less than main category icon for hierarchy */
            margin-right: 1rem;
            vertical-align: middle;
            flex-shrink: 0;
            width: 32px;
            text-align: center;
            transition: color 1.2s ease-in-out;
        }

        .category-item {
            background: var(--light-color);
            border-radius: 10px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            border: 1px solid var(--category-item-border-color);
            display: flex;
            align-items: flex-start;
            transition: background-color 0.2s ease, border-color 1.2s ease-in-out;
        }

        .category-item:hover {
            background-color: #e9ecef; /* This needs to be themed too */
        }
        body.hnw-theme-active .category-item:hover { background-color: #FAF0E6; } /* Lighter linen */
        body.uhnw-theme-active .category-item:hover { background-color: #404040; } /* Slightly lighter dark gray */


        .item-title {
            font-weight: var(--item-title-font-weight);
            font-size: 1.0rem;
            color: var(--dark-color);
            margin-bottom: 0.3rem;
            display: flex;
            align-items: center;
            transition: color 1.2s ease-in-out, font-weight 0.5s ease;
        }

        .item-description {
            color: var(--item-description-color);
            font-size: 0.85rem;
            line-height: 1.5;
            margin-bottom: 0.3rem;
            transition: color 1.2s ease-in-out;
        }

        .item-financial-note {
            color: var(--secondary-color); /* Changed from #555 */
            font-size: 0.8rem;
            font-style: italic;
            margin-top: 0.4rem;
            opacity: 0.9;
            transition: color 1.2s ease-in-out;
        }

        /* Specific category border colors - these should remain distinct */
        .dining { border-left-color: #fd7e14 !important; }
        .dining .category-icon, .dining .category-item-icon { color: #fd7e14 !important; }
        .travel { border-left-color: #0dcaf0 !important; }
        .travel .category-icon, .travel .category-item-icon { color: #0dcaf0 !important; }
        .housing { border-left-color: #198754 !important; }
        .housing .category-icon, .housing .category-item-icon { color: #198754 !important; }
        .transportation { border-left-color: #6f42c1 !important; }
        .transportation .category-icon, .transportation .category-item-icon { color: #6f42c1 !important; }
        .entertainment { border-left-color: #d63384 !important; }
        .entertainment .category-icon, .entertainment .category-item-icon { color: #d63384 !important; }
        .education { border-left-color: #ffc107 !important; }
        .education .category-icon, .education .category-item-icon { color: #ffc107 !important; }
        .health-wellness { border-left-color: #e83e8c !important; }
        .health-wellness .category-icon, .health-wellness .category-item-icon { color: #e83e8c !important; }
        .services { border-left-color: #6c757d !important; } /* This is default secondary, might clash if secondary changes */
        .services .category-icon, .services .category-item-icon { color: #6c757d !important; }
        .financial-planning { border-left-color: #20c997 !important; }
        .financial-planning .category-icon, .financial-planning .category-item-icon { color: #20c997 !important; }

        /* Ensure category specific borders and icons are NOT overridden by primary color changes in HNW/UHNW themes */
        body.hnw-theme-active .lifestyle-category, body.uhnw-theme-active .lifestyle-category {
             /* border-left-color will be handled by the specific classes above with !important */
        }
        body.hnw-theme-active .category-icon, body.hnw-theme-active .category-item-icon,
        body.uhnw-theme-active .category-icon, body.uhnw-theme-active .category-item-icon {
            /* color will be handled by the specific classes above with !important */
        }
        /* This ensures the general --primary-color doesn't override the specific category icon colors if they are not specific enough */
         .lifestyle-category .category-icon, .lifestyle-category .category-item-icon {
            /* Fallback to primary if not specifically themed by category color */
            color: var(--primary-color);
        }


        .item-budget-percent {
            color: var(--success-color);
            font-size: 0.8rem;
            font-weight: 500;
            margin-top: 0.4rem;
            display: block;
        }

        .badges-container {
            margin-top: 0.75rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .badge-custom {
            padding: 0.35rem 0.85rem;
            border-radius: 50px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-width: 1px;
            border-style: solid;
            display: inline-flex;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            transition: all 0.2s ease-in-out;
        }

        .badge-custom:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.12);
        }

        .badge-budgetSmart {
            background-color: var(--badge-budgetSmart-bg);
            color: var(--badge-budgetSmart-text);
            border-color: var(--badge-budgetSmart-text);
        }

        .badge-milestone {
            background-color: var(--badge-milestone-bg);
            color: var(--badge-milestone-text);
            border-color: var(--badge-milestone-text);
        }

        .badge-essential {
            background-color: var(--badge-essential-bg);
            color: var(--badge-essential-text);
            border-color: var(--badge-essential-text);
        }

        .badge-premium {
            background-color: var(--badge-premium-bg);
            color: var(--badge-premium-text);
            border-color: var(--badge-premium-text);
        }

        .badge-ultraPremium {
            background-color: var(--badge-ultraPremium-bg);
            color: var(--badge-ultraPremium-text);
            border-color: var(--badge-ultraPremium-text);
        }

        .badge-aspirational {
            background-color: var(--badge-aspirational-bg);
            color: var(--badge-aspirational-text);
            border-color: var(--badge-aspirational-text);
        }

        .badge-convenience {
            background-color: var(--badge-convenience-bg);
            color: var(--badge-convenience-text);
            border-color: var(--badge-convenience-text);
        }

        .badge-statusSymbol {
            background-color: var(--badge-statusSymbol-bg);
            color: var(--badge-statusSymbol-text);
            border-color: var(--badge-statusSymbol-text);
        }

        .dining {
            border-left-color: #fd7e14;
        }

        .dining .category-icon {
            color: #fd7e14;
        }

        .dining .category-item-icon {
            color: #fd7e14 !important;
        }

        .travel {
            border-left-color: #0dcaf0;
        }

        .travel .category-icon {
            color: #0dcaf0;
        }

        .travel .category-item-icon {
            color: #0dcaf0 !important;
        }

        .housing {
            border-left-color: #198754;
        }

        .housing .category-icon {
            color: #198754;
        }

        .housing .category-item-icon {
            color: #198754 !important;
        }

        .transportation {
            border-left-color: #6f42c1;
        }

        .transportation .category-icon {
            color: #6f42c1;
        }

        .transportation .category-item-icon {
            color: #6f42c1 !important;
        }

        .entertainment {
            border-left-color: #d63384;
        }

        .entertainment .category-icon {
            color: #d63384;
        }

        .entertainment .category-item-icon {
            color: #d63384 !important;
        }

        .education {
            border-left-color: #ffc107;
        }

        .education .category-icon {
            color: #ffc107;
        }

        .education .category-item-icon {
            color: #ffc107 !important;
        }

        .health-wellness {
            border-left-color: #e83e8c;
        }

        .health-wellness .category-icon {
            color: #e83e8c;
        }

        .health-wellness .category-item-icon {
            color: #e83e8c !important;
        }

        .services {
            border-left-color: #6c757d;
        }

        .services .category-icon {
            color: #6c757d;
        }

        .services .category-item-icon {
            color: #6c757d !important;
        }

        .financial-planning {
            border-left-color: #20c997;
        }

        .financial-planning .category-icon {
            color: #20c997;
        }

        .financial-planning .category-item-icon {
            color: #20c997 !important;
        }


        #milestone-popup {
            position: fixed;
            bottom: -100px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--dark-color); /* Themed */
            color: var(--light-color); /* Themed for contrast */
            padding: 1rem 2rem;
            border-radius: 50px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.25);
            transition: bottom 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275), background-color 1.2s ease, color 1.2s ease;
            z-index: 1050;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        #milestone-popup.show { bottom: 25px; }
        .highlight-update { animation: highlight-animation 1.2s ease-out; }
        @keyframes highlight-animation {
            0% {
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
                transform: scale(1);
            }

            30% {
                box-shadow: 0 10px 40px rgba(255, 193, 7, 0.7);
                /* Bright yellow glow */
                transform: scale(1.02);
            }

            100% {
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
                transform: scale(1);
            }
        }

        @keyframes itemEntryAnimation {
            from {
                opacity: 0;
                transform: translateX(-20px) scale(0.98);
            }

            to {
                opacity: 1;
                transform: translateX(0) scale(1);
            }
        }

        .animate-item-entry {
            animation: itemEntryAnimation 0.45s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        .fade-in {
            animation: fadeIn 0.6s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
    <meta content="images/lifestyle-calculator.png" property="og:image" />
    <meta content="images/lifestyle-calculator.png" name="twitter:image" />
</head>

<body>
    <div class="background-container">
        <div id="background-layer-1"></div>
        <div id="background-layer-2"></div>
    </div>

    <main class="container">
        <div class="main-container">
            <div class="text-center">
                <h1 class="page-title">ðŸ’° Lifestyle Calculator</h1>
                <p class="page-subtitle">Slide to see what your income *really* affords for your family!</p>
                <p class="calculator-note"><i class="bi bi-info-circle-fill"></i> This calculator estimates lifestyle
                    based on **annual family budget**, not net worth. Cost of Living (COLA) adjustment provides regional
                    context.</p>
            </div>

            <div class="controls-container">
                <div class="row align-items-center">
                    <div class="col-lg-8">
                        <div class="row">
                            <div class="col-md-6 mb-3 mb-md-0">
                                <label class="form-label" for="colaSelector">Cost of Living Adjustment (COLA):</label>
                                <select class="form-select form-select-sm" id="colaSelector"></select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label" for="familySizeSelector">Household / Life Stage:</label>
                                <select class="form-select form-select-sm" id="familySizeSelector">
                                    <option value="single">Single</option>
                                    <option value="couple">Couple / DINK</option>
                                    <option value="family" selected>Family with Kids</option>
                                </select>
                            </div>
                        </div>
                        <div class="income-display mt-3" id="incomeDisplay">$50,000</div>
                        <div class="effective-income-display" id="effectiveIncomeDisplay"></div>
                        <div class="income-bracket-label" id="incomeBracketLabel">Lower Middle Class</div>
                        <div class="income-bracket-description" id="incomeBracketDescription">Making ends meet, with a
                            little extra for fun.</div>
                        <input class="slider" id="incomeSlider" max="14" min="0" type="range" value="2" />
                        <div class="slider-labels">
                            <span>$20K</span>
                            <span>$1M</span>
                            <span>$25M</span>
                        </div>
                    </div>
                    <div class="col-lg-4 d-flex justify-content-center align-items-center mt-3 mt-lg-0">
                        <canvas id="budgetChart" style="max-height: 250px; max-width: 250px;"></canvas>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-6">
                    <div class="lifestyle-category dining fade-in">
                        <div class="category-title"><i class="bi bi-egg-fried category-icon"></i> Dining & Food</div>
                        <div id="dining-content"></div>
                    </div>
                    <div class="lifestyle-category travel fade-in">
                        <div class="category-title"><i class="bi bi-airplane category-icon"></i> Travel & Vacations
                        </div>
                        <div id="travel-content"></div>
                    </div>
                    <div class="lifestyle-category housing fade-in">
                        <div class="category-title"><i class="bi bi-house-door category-icon"></i> Housing & Living
                        </div>
                        <div id="housing-content"></div>
                    </div>
                    <div class="lifestyle-category transportation fade-in">
                        <div class="category-title"><i class="bi bi-car-front-fill category-icon"></i> Transportation
                        </div>
                        <div id="transportation-content"></div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="lifestyle-category entertainment fade-in">
                        <div class="category-title"><i class="bi bi-dice-5-fill category-icon"></i> Entertainment &
                            Hobbies</div>
                        <div id="entertainment-content"></div>
                    </div>
                    <div class="lifestyle-category education fade-in">
                        <div class="category-title"><i class="bi bi-book-half category-icon"></i> Education & Growth
                        </div>
                        <div id="education-content"></div>
                    </div>
                    <div class="lifestyle-category health-wellness fade-in">
                        <div class="category-title"><i class="bi bi-heart-pulse-fill category-icon"></i> Health &
                            Wellness</div>
                        <div id="health-wellness-content"></div>
                    </div>
                    <div class="lifestyle-category services fade-in">
                        <div class="category-title"><i class="bi bi-person-check-fill category-icon"></i> Personal
                            Services</div>
                        <div id="services-content"></div>
                    </div>
                    <div class="lifestyle-category financial-planning fade-in">
                        <div class="category-title"><i class="bi bi-piggy-bank category-icon"></i> Financial Planning &
                            Investments</div>
                        <div id="financial-services-content"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="container text-center py-3">
        <div class="mb-3">
            <strong>Related Financial Tools:</strong><br>
            <a class="mx-2" href="housing-comparison.html" rel="noopener noreferrer" target="_blank" title="Housing Budget Comparison Tool">
                <i class="bi bi-house-door"></i>
                Housing Comparison
            </a>
            <a class="mx-2" href="currency-timeline.html" rel="noopener noreferrer" target="_blank" title="History of Money and Currency">
                <i class="bi bi-clock-history"></i>
                Currency Timeline
            </a>
            <a class="mx-2" href="capitalism.html" rel="noopener noreferrer" target="_blank" title="Capitalism Principles Guide">
                <i class="bi bi-graph-up"></i>
                Capitalism Guide
            </a>
        </div>
        <div>
            <a class="mx-2 link-secondary" href="https://www.linkedin.com/in/davidveksler/" target="_blank"
                title="David Veksler on LinkedIn">
                <i class="bi bi-linkedin"></i> LinkedIn
            </a>
            <a class="mx-2 link-secondary" href="https://cheatsheets.davidveksler.com/" title="Browse All Cheatsheets">
                <i class="bi bi-collection"></i> All Cheatsheets
            </a>
        </div>
    </footer>

    <div id="milestone-popup">
        <span id="milestone-emoji"></span>
        <span>Milestone Unlocked: <strong id="milestone-text"></strong></span>
    </div>

    <!-- Main Application Script -->
    <script>
        let incomeBrackets = [];
        let lifestyleData = {};
        let costOfLivingFactors = [];
        let householdSizeAdjustments = {};
        let currentCurrencySymbol = "$";
        let budgetChart;
        let lastSliderValue = -1;
        let lastShownMilestone = -1;

        const HNW_THRESHOLD_INDEX = 9; // "Ultra High Net Worth" Corresponds to incomeBrackets[9]
        const UHNW_THRESHOLD_INDEX = 12; // "Ultra Wealthy" Corresponds to incomeBrackets[12]

        // Store default style values
        const defaultStyles = {
            primaryColor: '#0d6efd',
            primaryColorRGB: '13, 110, 253',
            secondaryColor: '#6c757d',
            darkColor: '#212529',
            lightColor: '#f8f9fa',
            bodyBgColor: '#e9ecef',
            mainContainerBg: 'rgba(255, 255, 255, 0.98)',
            mainContainerShadow: '0 15px 40px rgba(0, 0, 0, 0.12)',
            cardShadow: '0 10px 25px rgba(0, 0, 0, 0.1)',
            pageTitleFontFamily: "'Roboto Slab', serif",
            pageTitleColor: '#0d6efd', // Tied to primary
            pageTitleLetterSpacing: 'normal',
            pageTitleTextTransform: 'none',
            pageTitleFontWeight: '700',
            categoryTitleFontFamily: "'Roboto Slab', serif",
            categoryTitleLetterSpacing: 'normal',
            categoryTitleTextTransform: 'none',
            categoryTitleFontWeight: '700',
            categoryIconOpacity: '0.8',
            itemTitleFontWeight: '600',
            itemDescriptionColor: '#495057',
            categoryItemBorderColor: '#dee2e6',
            sliderThumbBg: '#0d6efd', // Tied to primary
            sliderThumbBorder: '5px solid white',
            sliderThumbShadowOpacity: '0.5',
            calculatorNoteBg: '#fff3cd',
            calculatorNoteBorder: '#ffeeba',
            calculatorNoteText: '#212529', // Tied to darkColor
            incomeBracketDescColor: '#495057',
            chartLegendTextColor: '#495057'
        };


        const slider = document.getElementById('incomeSlider');
        const incomeDisplayEl = document.getElementById('incomeDisplay');
        const effectiveIncomeDisplayEl = document.getElementById('effectiveIncomeDisplay');
        const incomeBracketLabelEl = document.getElementById('incomeBracketLabel');
        const incomeBracketDescEl = document.getElementById('incomeBracketDescription');
        const colaSelectorEl = document.getElementById('colaSelector');
        const familySizeSelectorEl = document.getElementById('familySizeSelector');
        const rootStyle = document.documentElement.style;

        const bgLayer1 = document.getElementById('background-layer-1');
        const bgLayer2 = document.getElementById('background-layer-2');
        let activeBgLayer = 1;

        function formatIncome(income, symbol = "$") {
            if (income >= 1000000) return `${symbol}${(income / 1000000).toFixed(income % 1000000 === 0 ? 0 : (income < 10000000 ? 1 : 0))}M`;
            if (income >= 1000) return `${symbol}${(income / 1000).toFixed(0)}K`;
            return `${symbol}${income.toLocaleString()}`;
        }

        function getRGBFromHex(hex) {
            if (!hex || typeof hex !== 'string') return defaultStyles.primaryColorRGB; // Fallback
            let r = 0, g = 0, b = 0;
            const hexColor = hex.startsWith('#') ? hex : `#${hex}`; // Ensure '#' prefix

            if (hexColor.length === 4) { // #RGB
                r = parseInt(hexColor[1] + hexColor[1], 16);
                g = parseInt(hexColor[2] + hexColor[2], 16);
                b = parseInt(hexColor[3] + hexColor[3], 16);
            } else if (hexColor.length === 7) { // #RRGGBB
                r = parseInt(hexColor.substring(1, 3), 16);
                g = parseInt(hexColor.substring(3, 5), 16);
                b = parseInt(hexColor.substring(5, 7), 16);
            } else {
                return defaultStyles.primaryColorRGB; // Fallback for invalid hex
            }
            if (isNaN(r) || isNaN(g) || isNaN(b)) return defaultStyles.primaryColorRGB; // Fallback for parsing errors
            return `${r}, ${g}, ${b}`;
        }

        function updatePrimaryRGBVar(hexColor) {
            const rgbString = getRGBFromHex(hexColor);
            document.documentElement.style.setProperty('--primary-color-rgb', rgbString);
        }



        function updateThemeStyling(bracketIndex) {

            const body = document.body;

            body.classList.remove('hnw-theme-active', 'uhnw-theme-active');

            if (bracketIndex >= UHNW_THRESHOLD_INDEX) { // UHNW Theme
                body.classList.add('uhnw-theme-active');
                rootStyle.setProperty('--primary-color', '#00A9E0'); // Vibrant Blue
                updatePrimaryRGBVar('#00A9E0');
                rootStyle.setProperty('--secondary-color', '#A9A9A9'); // Light Gray
                rootStyle.setProperty('--dark-color', '#F5F5F5'); // Main text (White Smoke)
                rootStyle.setProperty('--light-color', '#282828'); // Element BGs (Dark Gray)
                rootStyle.setProperty('--body-bg-color', '#121212'); // Very Dark Gray/Black
                rootStyle.setProperty('--main-container-bg', 'rgba(20, 20, 20, 0.97)'); // Slightly transparent dark
                rootStyle.setProperty('--main-container-shadow', '0 15px 50px rgba(0, 169, 224, 0.2)');
                rootStyle.setProperty('--card-shadow', '0 10px 30px rgba(0, 169, 224, 0.15)');

                rootStyle.setProperty('--page-title-color', 'var(--primary-color)');
                // Typography changes for UHNW are in CSS via body.uhnw-theme-active .page-title

                rootStyle.setProperty('--category-icon-opacity', '1');
                rootStyle.setProperty('--item-title-font-weight', '700');
                rootStyle.setProperty('--item-description-color', '#D3D3D3'); // LightGray for descriptions
                rootStyle.setProperty('--category-item-border-color', '#444444');

                rootStyle.setProperty('--slider-thumb-bg', 'var(--primary-color)');
                rootStyle.setProperty('--slider-thumb-border', '3px solid #555555'); // Darker border for thumb
                rootStyle.setProperty('--slider-thumb-shadow-opacity', '0.7');

                rootStyle.setProperty('--calculator-note-bg', '#303030');
                rootStyle.setProperty('--calculator-note-border', '#505050');
                rootStyle.setProperty('--calculator-note-text', '#E0E0E0');
                rootStyle.setProperty('--income-bracket-desc-color', '#B0B0B0');
                rootStyle.setProperty('--chart-legend-text-color', '#D3D3D3');


                // UHNW Background Override
                if (activeBgLayer === 1) {
                    bgLayer2.className = 'background-layer theme-uhnw-bg';
                    bgLayer1.style.opacity = 0; bgLayer2.style.opacity = 1; activeBgLayer = 2;
                } else {
                    bgLayer1.className = 'background-layer theme-uhnw-bg';
                    bgLayer1.style.opacity = 1; bgLayer2.style.opacity = 0; activeBgLayer = 1;
                }

            } else if (bracketIndex >= HNW_THRESHOLD_INDEX) { // HNW Theme
                body.classList.add('hnw-theme-active');
                rootStyle.setProperty('--primary-color', '#B8860B'); // DarkGoldenRod
                updatePrimaryRGBVar('#B8860B');
                rootStyle.setProperty('--secondary-color', '#4A3B15'); // Darker Brown/Gold
                rootStyle.setProperty('--dark-color', '#3B2E0E'); // Main text (Very Dark Brown)
                rootStyle.setProperty('--light-color', '#FFF8DC'); // Element BGs (Cornsilk)
                rootStyle.setProperty('--body-bg-color', '#FDF5E6'); // Linen
                rootStyle.setProperty('--main-container-bg', 'rgba(253, 245, 230, 0.98)'); // Slightly transparent Linen
                rootStyle.setProperty('--main-container-shadow', '0 15px 40px rgba(184, 134, 11, 0.2)');
                rootStyle.setProperty('--card-shadow', '0 10px 25px rgba(184, 134, 11, 0.15)');

                rootStyle.setProperty('--page-title-color', 'var(--primary-color)');
                // Typography changes for HNW are in CSS via body.hnw-theme-active .page-title

                rootStyle.setProperty('--category-icon-opacity', '0.9');
                rootStyle.setProperty('--item-title-font-weight', '600'); // Default is fine
                rootStyle.setProperty('--item-description-color', '#554216'); // Darker Brown for descriptions
                rootStyle.setProperty('--category-item-border-color', '#E0D6B3'); // Pale Gold/Beige

                rootStyle.setProperty('--slider-thumb-bg', 'var(--primary-color)');
                rootStyle.setProperty('--slider-thumb-border', '4px solid #FFF8DC'); // Cornsilk border
                rootStyle.setProperty('--slider-thumb-shadow-opacity', '0.6');

                rootStyle.setProperty('--calculator-note-bg', '#FAF0E6'); // Lighter Linen
                rootStyle.setProperty('--calculator-note-border', '#E8DDCB'); // Darker Linen border
                rootStyle.setProperty('--calculator-note-text', 'var(--dark-color)');
                rootStyle.setProperty('--income-bracket-desc-color', '#6F5E33'); // Medium Brown
                rootStyle.setProperty('--chart-legend-text-color', '#554216'); // Darker Brown for legend


                // HNW Background Override
                 if (activeBgLayer === 1) {
                    bgLayer2.className = 'background-layer theme-hnw-bg';
                    bgLayer1.style.opacity = 0; bgLayer2.style.opacity = 1; activeBgLayer = 2;
                } else {
                    bgLayer1.className = 'background-layer theme-hnw-bg';
                    bgLayer1.style.opacity = 1; bgLayer2.style.opacity = 0; activeBgLayer = 1;
                }


            } else { // Default Theme
                Object.keys(defaultStyles).forEach(key => {
                    const cssVarName = `--${key.replace(/([A-Z])/g, '-$1').toLowerCase()}`;
                    if (key === 'primaryColorRGB') {
                         updatePrimaryRGBVar(defaultStyles.primaryColor); // Ensure RGB is set from the hex
                    } else if (key === 'pageTitleColor' || key === 'sliderThumbBg') {
                        rootStyle.setProperty(cssVarName, `var(--primary-color)`);
                    } else if (key === 'calculatorNoteText') {
                         rootStyle.setProperty(cssVarName, `var(--dark-color)`);
                    }
                    else {
                         rootStyle.setProperty(cssVarName, defaultStyles[key]);
                    }
                });
                // Ensure primary color itself and its RGB are reset based on defaultStyles.primaryColor
                rootStyle.setProperty('--primary-color', defaultStyles.primaryColor);
                updatePrimaryRGBVar(defaultStyles.primaryColor); // Explicitly reset RGB from default hex

                // Let original dynamic background logic take over
                updateDynamicBackground(bracketIndex, true);
            }
            // Apply body background color explicitly after all var changes
            body.style.backgroundColor = rootStyle.getPropertyValue('--body-bg-color').trim();
        }


        function updateDynamicBackground(bracketIndex, forceDefaultLogic = false) {
            // If HNW/UHNW themes are active, their specific backgrounds are set in updateThemeStyling.
            // This function should only run for brackets *below* HNW/UHNW or if forced.
            if (!forceDefaultLogic && (document.body.classList.contains('hnw-theme-active') || document.body.classList.contains('uhnw-theme-active'))) {
                return;
            }

            let themeClass = '';
            // These thresholds define the non-HNW/UHNW background themes
            if (bracketIndex <= 1) themeClass = 'theme-basic';
            else if (bracketIndex <= 3) themeClass = 'theme-comfortable';
            else if (bracketIndex <= 5) themeClass = 'theme-affluent'; // Affluent up to index 5 ($150k)
            else if (bracketIndex <= HNW_THRESHOLD_INDEX -1 ) themeClass = 'theme-luxury'; // Luxury up to index 8 ($500k), before HNW at 9
            // No 'ultra' or 'elite' needed here as they would fall into HNW/UHNW index ranges
            // Or, if HNW_THRESHOLD is, say, 6, then luxury would not be hit.
            // This logic needs to be robust for HNW_THRESHOLD_INDEX.
            // Example:
            // 0,1: basic
            // 2,3: comfortable
            // 4,5: affluent (Affluent is bracket index 5, $150k)
            // 6,7,8: luxury (High Income $200k, Wealthy $300k, Very Wealthy $500k are indices 6,7,8)
            // HNW starts at index 9 ($750k UHNW by original label)
            // UHNW starts at index 12 ($5M Ultra Wealthy by original label)

            // Let's refine the non-HNW/UHNW theme classes based on original progression idea
            if (bracketIndex <= 1) themeClass = 'theme-basic';         // Working Poor, Low Income
            else if (bracketIndex <= 3) themeClass = 'theme-comfortable'; // Lower Mid, Middle Class
            else if (bracketIndex <= 5) themeClass = 'theme-affluent';    // Upper Mid, Affluent
            else if (bracketIndex < HNW_THRESHOLD_INDEX) themeClass = 'theme-luxury'; // High Income, Wealthy, Very Wealthy
            // If HNW/UHNW logic is bypassed (forceDefaultLogic), this still needs to pick *something*
            else if (bracketIndex < UHNW_THRESHOLD_INDEX) themeClass = 'theme-ultra'; // (Original) UHNW, Millionaire, Multi-Millionaire
            else themeClass = 'theme-elite'; // (Original) Ultra Wealthy, Ultra Elite, Billionaire Class


            if (activeBgLayer === 1) {
                bgLayer2.className = `background-layer ${themeClass}`;
                bgLayer1.style.opacity = 0;
                bgLayer2.style.opacity = 1;
                activeBgLayer = 2;
            } else {
                bgLayer1.className = `background-layer ${themeClass}`;
                bgLayer1.style.opacity = 1;
                bgLayer2.style.opacity = 0;
                activeBgLayer = 1;
            }
        }

        function updateBudgetChart(bracketIndex) {
            const bracketData = incomeBrackets[bracketIndex];
            if (!bracketData || !bracketData.budgetAllocation) return;

            const labels = Object.keys(bracketData.budgetAllocation);
            const data = Object.values(bracketData.budgetAllocation);

            const isUHNW = document.body.classList.contains('uhnw-theme-active');
            const isHNW = document.body.classList.contains('hnw-theme-active');

            const legendTextColor = getComputedStyle(document.documentElement).getPropertyValue('--chart-legend-text-color').trim() || defaultStyles.chartLegendTextColor;
            const chartBorderColor = isUHNW ? '#121212' : (isHNW ? '#FDF5E6' : '#ffffff');


            const defaultColorPalette = ['#2d4059', '#ea5455', '#f07b3f', '#ffd460', '#7e9a9a', '#4a6c6f', '#99a8b2', '#596e79'];
            const hnwColorPalette = ['#A0522D', '#CD853F', '#D2B48C', '#B8860B', '#F4A460', '#8B4513', '#BC8F8F', '#DEB887']; // Sienna, Peru, Tan, DarkGoldenRod, SandyBrown, SaddleBrown, RosyBrown, BurlyWood
            const uhnwColorPalette = ['#00BFFF', '#1E90FF', '#87CEFA', '#ADD8E6', '#B0E0E6', '#5F9EA0', '#4682B4', '#AFEEEE']; // DeepSkyBlue, DodgerBlue, LightSkyBlue, LightBlue, PowderBlue, CadetBlue, SteelBlue, PaleTurquoise


            let currentPalette;
            if (isUHNW) currentPalette = uhnwColorPalette;
            else if (isHNW) currentPalette = hnwColorPalette;
            else currentPalette = defaultColorPalette;


            const chartConfig = {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Budget Allocation',
                        data: data,
                        backgroundColor: currentPalette,
                        borderColor: chartBorderColor,
                        borderWidth: 3,
                        hoverBorderColor: isUHNW ? '#333333' : (isHNW ? '#FAF0E6' : '#f8f9fa'),
                        hoverBorderWidth: 1,
                        hoverOffset: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    animation: { animateScale: true, animateRotate: true },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'right',
                            align: 'center',
                            labels: {
                                boxWidth: 12,
                                padding: 15,
                                font: { size: 11, family: "'Inter', sans-serif" },
                                color: legendTextColor
                            }
                        },
                        tooltip: {
                            enabled: true,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleFont: { size: 14, weight: 'bold' },
                            bodyFont: { size: 12 },
                            padding: 12,
                            cornerRadius: 8,
                            callbacks: {
                                label: function (context) {
                                    let label = context.label || '';
                                    if (label) label += ': ';
                                    if (context.parsed !== null) label += context.parsed + '%';
                                    return label;
                                }
                            }
                        }
                    },
                    layout: { padding: { left: 0, right: 10 } }
                }
            };

            if (budgetChart) {
                budgetChart.data.labels = labels;
                budgetChart.data.datasets[0].data = data;
                budgetChart.data.datasets[0].backgroundColor = currentPalette;
                budgetChart.data.datasets[0].borderColor = chartBorderColor;
                budgetChart.options.plugins.legend.labels.color = legendTextColor;
                budgetChart.update();
            } else {
                const ctx = document.getElementById('budgetChart').getContext('2d');
                budgetChart = new Chart(ctx, chartConfig);
            }
        }

        function showMilestone(bracketIndex) {
            const bracket = incomeBrackets[bracketIndex];
            if (bracket.milestone && bracketIndex > lastSliderValue && bracketIndex > lastShownMilestone) {
                document.getElementById('milestone-emoji').textContent = bracket.milestone.emoji;
                document.getElementById('milestone-text').textContent = bracket.milestone.title;
                const popup = document.getElementById('milestone-popup');
                popup.classList.add('show');
                lastShownMilestone = bracketIndex;
                setTimeout(() => {
                    popup.classList.remove('show');
                }, 3500);
            }
        }

        function getCategoryMultiplier(category, selectedColaOption, householdAdjustment) {
            const categoryMap = {
                'dining': 'foodMultiplier',
                'housing': 'housingMultiplier',
                'transportation': 'transportMultiplier',
                'travel': 'foodMultiplier', // travel costs often correlate with food costs
                'entertainment': 'foodMultiplier', // entertainment often correlates with food costs
                'health-wellness': 'foodMultiplier',
                'services': 'foodMultiplier',
                'education': 'foodMultiplier',
                'financial-services': 'foodMultiplier'
            };
            
            const colaMultiplierType = categoryMap[category] || 'foodMultiplier';
            const colaMultiplier = parseFloat(selectedColaOption.dataset[colaMultiplierType] || selectedColaOption.dataset.factor);
            
            const householdMultiplierMap = {
                'dining': 'foodMultiplier',
                'housing': 'housingMultiplier', 
                'transportation': 'transportMultiplier',
                'travel': 'travelMultiplier',
                'entertainment': 'entertainmentMultiplier',
                'health-wellness': 'healthWellnessMultiplier',
                'services': 'servicesMultiplier',
                'education': 'educationMultiplier',
                'financial-services': 'servicesMultiplier'
            };
            
            const householdMultiplierType = householdMultiplierMap[category] || 'incomeMultiplier';
            const householdMultiplier = householdAdjustment[householdMultiplierType] || 1.0;
            
            return colaMultiplier * householdMultiplier;
        }

        function updateLifestyle() {
            if (!incomeBrackets || incomeBrackets.length === 0 || !costOfLivingFactors || costOfLivingFactors.length === 0 || !householdSizeAdjustments) return;

            const selectedBracketIndex = parseInt(slider.value);
            const baseBracket = incomeBrackets[selectedBracketIndex];
            if (!baseBracket) return;

            updateThemeStyling(selectedBracketIndex);

            const selectedColaOption = colaSelectorEl.options[colaSelectorEl.selectedIndex];
            const selectedColaFactor = parseFloat(selectedColaOption.dataset.factor);
            const salaryAdjustment = parseFloat(selectedColaOption.dataset.salaryAdjustment);
            currentCurrencySymbol = selectedColaOption.dataset.currency;
            const selectedFamilySize = familySizeSelectorEl.value;

            // Calculate effective income with household size and salary adjustments
            const householdAdjustment = householdSizeAdjustments[selectedFamilySize] || { incomeMultiplier: 1.0 };
            const adjustedIncome = baseBracket.income * salaryAdjustment * householdAdjustment.incomeMultiplier;
            const effectiveIncome = adjustedIncome / selectedColaFactor;

            incomeDisplayEl.textContent = formatIncome(baseBracket.income, currentCurrencySymbol);

            let effectiveText = "";
            if (householdAdjustment.incomeMultiplier !== 1.0) {
                effectiveText += `(${householdAdjustment.label}: ~${formatIncome(adjustedIncome, currentCurrencySymbol)}`;;
                if (selectedColaFactor !== 1.0) {
                    effectiveText += ` â†’ ~${formatIncome(effectiveIncome, currentCurrencySymbol)} in selected city)`;
                } else {
                    effectiveText += `)`;
                }
            } else if (selectedColaFactor !== 1.0) {
                effectiveText = `(Effectively ~${formatIncome(effectiveIncome, currentCurrencySymbol)} in selected city)`;
            }
            effectiveIncomeDisplayEl.textContent = effectiveText;
            incomeBracketLabelEl.textContent = baseBracket.label;
            incomeBracketDescEl.textContent = baseBracket.description;

            // Background logic is now complex:
            // 1. updateThemeStyling sets specific HNW/UHNW backgrounds.
            // 2. If not HNW/UHNW, updateThemeStyling calls updateDynamicBackground with force=true
            //    to use the original progressive backgrounds.
            // So, no explicit call to updateDynamicBackground needed here unless it's for non-HNW/UHNW only.
            // updateThemeStyling handles the conditional logic for background setting.

            updateBudgetChart(selectedBracketIndex);
            showMilestone(selectedBracketIndex);

            Object.keys(lifestyleData).forEach(category => {
                const categoryData = lifestyleData[category];
                const contentDivId = `${category.replace(/([A-Z])/g, '-$1').toLowerCase()}-content`;
                const contentDiv = document.getElementById(contentDivId);

                if (!contentDiv) {
                    console.warn(`Content div not found for category ID: ${contentDivId}`);
                    return;
                }

                const oldHTML = contentDiv.innerHTML;

                let itemsToDisplay = [];
                for (let i = categoryData.length - 1; i >= 0; i--) {
                    if (selectedBracketIndex >= categoryData[i].min) {
                        itemsToDisplay = categoryData[i].items.filter(item => {
                            if (!item.modifiers || !item.modifiers.familySize) return true;
                            return item.modifiers.familySize.includes(selectedFamilySize);
                        });
                        break;
                    }
                }

                const itemsHTML = itemsToDisplay.map((item, idx) => {
                    const badgesHTML = item.badges ? `<div class="badges-container">${item.badges.map(badge => `<span class="badge-custom badge-${badge.toLowerCase().replace(/\s+/g, '')}">${badge.replace(/([A-Z])/g, ' $1').trim()}</span>`).join('')}</div>` : '';
                    const itemIconHTML = item.itemIcon ? `<i class="bi ${item.itemIcon} category-item-icon"></i>` : '<i class="bi bi-record-circle-fill category-item-icon"></i>';
                    const financialNoteHTML = item.financialNote ? `<div class="item-financial-note">${item.financialNote}</div>` : '';
                    return `
                <div class="category-item animate-item-entry" style="animation-delay: ${idx * 50}ms;">
                    ${itemIconHTML}
                    <div class="item-content-wrapper">
                        <div class="item-title">${item.title}</div>
                        <div class="item-description">${item.desc}</div>
                        ${financialNoteHTML}
                        ${badgesHTML}
                    </div>
                </div>`;
                }).join('');

                contentDiv.innerHTML = itemsHTML;

                if (contentDiv.innerHTML !== oldHTML) {
                    const categoryCard = contentDiv.closest('.lifestyle-category');
                    if (categoryCard) {
                        categoryCard.classList.remove('highlight-update');
                        void categoryCard.offsetWidth;
                        categoryCard.classList.add('highlight-update');
                    }
                }
            });
            lastSliderValue = selectedBracketIndex;
        }

        function initializeApp() {
            // Capture the *actual* initial primary color from CSS in case it was changed from Bootstrap default
            const actualInitialPrimaryColor = getComputedStyle(document.documentElement).getPropertyValue('--primary-color').trim();
            defaultStyles.primaryColor = actualInitialPrimaryColor;
            defaultStyles.primaryColorRGB = getRGBFromHex(actualInitialPrimaryColor);
            defaultStyles.pageTitleColor = actualInitialPrimaryColor; // Tie to actual initial
            defaultStyles.sliderThumbBg = actualInitialPrimaryColor;  // Tie to actual initial

            // Set all default styles to root, ensuring --primary-color-rgb is derived correctly
            Object.keys(defaultStyles).forEach(key => {
                 const cssVarName = `--${key.replace(/([A-Z])/g, '-$1').toLowerCase()}`;
                 if (key === 'primaryColorRGB') {
                    // This is handled by updatePrimaryRGBVar called below
                 } else if (key === 'pageTitleColor' || key === 'sliderThumbBg') {
                    rootStyle.setProperty(cssVarName, `var(--primary-color)`);
                 } else if (key === 'calculatorNoteText') {
                     rootStyle.setProperty(cssVarName, `var(--dark-color)`);
                 }
                 else {
                    document.documentElement.style.setProperty(cssVarName, defaultStyles[key]);
                 }
            });
            // Explicitly set primary color and its RGB derivative
            document.documentElement.style.setProperty('--primary-color', defaultStyles.primaryColor);
            updatePrimaryRGBVar(defaultStyles.primaryColor);
            document.body.style.backgroundColor = defaultStyles.bodyBgColor;


            costOfLivingFactors.forEach(factor => {
                const option = document.createElement('option');
                option.value = factor.city;
                option.textContent = factor.city;
                option.dataset.factor = factor.factor;
                option.dataset.currency = factor.currencySymbol;
                option.dataset.housingMultiplier = factor.housingMultiplier || factor.factor;
                option.dataset.foodMultiplier = factor.foodMultiplier || factor.factor;
                option.dataset.transportMultiplier = factor.transportMultiplier || factor.factor;
                option.dataset.salaryAdjustment = factor.salaryAdjustment || 1.0;
                colaSelectorEl.appendChild(option);
            });

            lastSliderValue = parseInt(slider.value);
            updateLifestyle();

            slider.addEventListener('input', updateLifestyle);
            colaSelectorEl.addEventListener('change', updateLifestyle);
            familySizeSelectorEl.addEventListener('change', updateLifestyle);

            document.querySelectorAll('.lifestyle-category.fade-in').forEach((category, index) => {
                category.style.opacity = '0';
                category.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    category.style.transition = 'opacity 0.5s ease-out, transform 0.5s ease-out';
                    category.style.opacity = '1';
                    category.style.transform = 'translateY(0)';
                }, index * 100 + 50);
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            fetch('https://cheatsheets.davidveksler.com/lifestyle-calculator-data.json')
                .then(response => { if (!response.ok) { throw new Error(`HTTP error! status: ${response.status}`); } return response.json(); })
                .then(data => {
                    incomeBrackets = data.incomeBrackets;
                    lifestyleData = data.lifestyleData;
                    costOfLivingFactors = data.costOfLivingFactors;
                    householdSizeAdjustments = data.householdSizeAdjustments || {};
                    slider.max = incomeBrackets.length - 1;
                    initializeApp();
                })
                .catch(error => {
                    console.error("Could not fetch or parse lifestyle data:", error);
                    const mainContainer = document.querySelector('.main-container');
                    if (mainContainer) { mainContainer.innerHTML = `<div class="alert alert-danger" role="alert"><strong>Error:</strong> Could not load lifestyle data. Please ensure 'lifestyle-calculator-data.json' is accessible.</div>`; }
                });
        });

    </script>
    <script crossorigin="anonymous" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>