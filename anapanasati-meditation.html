<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Practical Guide to Ānāpānasati: Mindfulness of Breathing</title>
    <style>
        /* --- Core Styling & "Gentle Current of Breath" Theme --- */
        :root {
            --primary-bg: #f4f7f6;
            --primary-bg-light-pulse: #f8fbfb; /* Lighter shade for breath pulse */
            --secondary-bg: #e8eeef;
            --text-color: #333d47;
            --accent-color: #7aa0a7;
            --highlight-color: #a7c4c4;
            --border-color: #cddce0;
            --font-sans-serif: 'Nunito Sans', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --body-font-size: 17px;
            --line-height: 1.7;
            --container-width: 800px;
            --nav-width: 60px; /* Width of the guided path navigation */
        }

        /* --- "Living Breath" Background Animation --- */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1; /* Behind all content */
            background: linear-gradient(135deg, var(--primary-bg), var(--primary-bg-light-pulse));
            animation: livingBreathAnimation 15s infinite ease-in-out alternate;
        }

        @keyframes livingBreathAnimation {
            0% {
                background: linear-gradient(135deg, var(--primary-bg), var(--primary-bg-light-pulse));
            }
            100% {
                background: linear-gradient(135deg, var(--primary-bg-light-pulse), var(--primary-bg));
            }
        }

        body {
            font-family: var(--font-sans-serif);
            background-color: transparent; /* Let the animated pseudo-element show through */
            color: var(--text-color);
            margin: 0;
            padding: 0;
            line-height: var(--line-height);
            font-size: var(--body-font-size);
            overflow-x: hidden;
            padding-left: var(--nav-width); /* Space for the guided path navigation */
        }

        .container {
            max-width: var(--container-width);
            margin: 0 auto;
            padding: 20px;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: var(--font-sans-serif);
            color: var(--text-color);
            margin-top: 2em;
            margin-bottom: 0.8em;
            font-weight: 600;
        }

        h1 { font-size: 2.5em; text-align: center; margin-bottom: 1em; font-weight: 700; color: var(--accent-color); }
        h2 { font-size: 1.8em; border-bottom: 2px solid var(--highlight-color); padding-bottom: 0.3em; }
        h3 { font-size: 1.4em; color: var(--accent-color); }
        h4 { font-size: 1.1em; font-weight: 600; }

        p, li {
            margin-bottom: 0.8em;
        }

        a {
            color: var(--accent-color);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        a:hover, a:focus {
            color: var(--highlight-color);
            text-decoration: underline;
        }

        .text-center { text-align: center; }
        .subtle-text { color: #5c6b73; font-size: 0.9em; }
        .screen-reader-text {
            position: absolute;
            left: -10000px;
            top: auto;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }

        .page-header {
            background-color: rgba(232, 238, 239, 0.8); /* Slightly transparent for depth */
            padding: 10px 0;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9em;
            position: relative; /* Ensure it's above the ::before pseudo-element */
            z-index: 10;
        }
        .page-header p { margin: 0; }

        .hero-section {
            background-color: rgba(232, 238, 239, 0.8); /* Slightly transparent */
            padding: 60px 20px;
            text-align: center;
            border-bottom: 3px solid var(--accent-color);
            margin-bottom: 30px;
            position: relative;
            z-index: 5;
        }
        .hero-section h1 { margin-top:0; font-size: 2.8em; color: var(--text-color); }
        .hero-section p { font-size: 1.2em; margin-bottom: 30px; color: #4a5560; }
        .cta-button {
            display: inline-block;
            background-color: var(--accent-color);
            color: white;
            padding: 15px 30px;
            font-size: 1.1em;
            border-radius: 5px;
            text-decoration: none;
            transition: background-color 0.3s ease, color 0.3s ease;
            font-weight: 600;
            border: none;
            cursor: pointer;
        }
        .cta-button:hover {
            background-color: var(--highlight-color);
            color: var(--text-color);
        }
        .secondary-link {
            display: block;
            margin-top: 20px;
            font-size: 0.9em;
        }

        .content-section {
            margin-bottom: 40px;
            padding: 25px; /* Increased padding slightly */
            background-color: rgba(255, 255, 255, 0.85); /* Slightly transparent cards for depth */
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.07); /* Softer shadow */
            position: relative;
            z-index: 5;
        }

        .breath-pacer-container {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background-color: rgba(232, 238, 239, 0.8);
            border-radius: 8px;
        }
        .breath-pacer-visual {
            width: 100px;
            height: 100px;
            background-color: var(--highlight-color);
            border-radius: 50%;
            margin: 10px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9em;
            animation: breathPacerAnimation 8s infinite ease-in-out;
        }
        @keyframes breathPacerAnimation { /* Renamed to avoid conflict */
            0% { transform: scale(0.8); opacity: 0.7; }
            50% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0.8); opacity: 0.7; }
        }
        .breath-pacer-controls button {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 8px 15px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .breath-pacer-controls button:hover {
            background-color: var(--highlight-color);
        }

        .posture-assessor {
            display: flex;
            align-items: flex-start;
            gap: 20px;
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(232, 238, 239, 0.7);
            border-radius: 8px;
        }
        .posture-silhouette {
            flex-shrink: 0;
            width: 150px;
            height: auto;
            border: 1px dashed var(--border-color);
            padding: 10px;
            text-align: center;
            position: relative;
        }
        .posture-silhouette svg { width: 100%; height: auto; }
        .hotspot {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: rgba(122, 160, 167, 0.5);
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .hotspot:hover { background-color: var(--accent-color); }
        .hotspot.head { top: 10px; left: 45%; }
        .hotspot.shoulders { top: 40px; left: 10%; width:80%; height:15px; border-radius: 5px;}
        .hotspot.spine { top: 30px; left: 47%; height: 70px; width: 6px; border-radius: 3px;}
        .hotspot.hands { bottom: 20px; left: 35%; }
        .posture-tips { flex-grow: 1; }
        .posture-tip {
            padding: 10px;
            background-color: var(--primary-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .troubleshooting-tree summary {
            cursor: pointer;
            font-weight: 600;
            color: var(--accent-color);
            padding: 8px;
            background-color: rgba(232, 238, 239, 0.7);
            border-radius: 4px;
            margin-bottom: 5px;
            list-style: none;
        }
        .troubleshooting-tree summary::-webkit-details-marker { display: none; }
        .troubleshooting-tree summary::before { content: '▶ '; margin-right: 5px; }
        .troubleshooting-tree[open] summary::before { content: '▼ '; }
        .troubleshooting-tree div {
            padding-left: 25px;
            border-left: 2px solid var(--highlight-color);
            margin-top: 5px;
        }

        .pali-term {
            border-bottom: 1px dotted var(--accent-color);
            cursor: help;
            position: relative;
        }
        .pali-term .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--text-color);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 100; /* Ensure tooltip is on top */
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s, visibility 0.3s;
            font-size: 0.85em;
            line-height: 1.4;
        }
        .pali-term:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .tetrad-toggle summary {
            cursor: pointer;
            font-weight: bold;
            padding: 10px;
            background-color: rgba(232, 238, 239, 0.7);
            border-radius: 4px;
            margin-bottom: 5px;
            list-style: none;
        }
        .tetrad-toggle summary::-webkit-details-marker { display: none; }
        .tetrad-toggle summary::before { content: '➕ '; color: var(--accent-color); margin-right: 8px; }
        .tetrad-toggle[open] summary::before { content: '➖ '; }
        .tetrad-content { padding: 10px 0 10px 30px; }
        .tetrad-content ol { padding-left: 20px; }

        .page-footer {
            text-align: center;
            padding: 30px 20px;
            margin-top: 40px;
            background-color: var(--text-color);
            color: var(--primary-bg);
            font-size: 0.9em;
            position: relative;
            z-index: 5;
        }
        .page-footer a { color: var(--highlight-color); }

        /* --- "Guided Path" Interactive Navigation --- */
        #guidedPathNav {
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            width: var(--nav-width);
            background-color: rgba(224, 230, 231, 0.85); /* Softer, slightly transparent */
            backdrop-filter: blur(5px); /* Frosted glass effect */
            z-index: 1000; /* On top of everything */
            padding-top: 80px; /* Space for page header if it were fixed */
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: width 0.3s ease; /* For potential hover expand */
        }

        #pathLine {
            position: absolute;
            top: 10%; /* Start path a bit down */
            left: 50%;
            transform: translateX(-50%);
            width: 3px; /* Thicker line */
            height: 80%; /* Span most of the nav height */
            background-color: var(--border-color);
            z-index: 1;
        }

        #pathMarker {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 18px; /* Larger marker */
            height: 18px;
            background-color: var(--accent-color);
            border: 2px solid white; /* Contrast */
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(122, 160, 167, 0.7);
            z-index: 2;
            transition: top 0.4s cubic-bezier(0.65, 0, 0.35, 1); /* Smoother transition */
        }

        #guidedPathNav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            width: 100%;
            position: relative; /* For positioning list items along the path */
            z-index: 2; /* Above pathLine */
            height: 80%; /* Match pathLine's relative height */
            top: 10%; /* Align with pathLine */
            display: flex;
            flex-direction: column;
            justify-content: space-around; /* Distribute items along the path */
        }

        #guidedPathNav li a {
            display: flex; /* Changed to flex for better alignment */
            align-items: center;
            justify-content: center; /* Center icon */
            width: calc(var(--nav-width) - 10px); /* Full width for click area */
            height: 40px; /* Clickable height */
            margin: 5px auto; /* Centering and spacing */
            color: var(--text-color);
            text-decoration: none;
            border-radius: 50%; /* Make the link area round like a dot initially */
            transition: background-color 0.3s ease, color 0.3s ease;
            position: relative; /* For tooltip/label */
        }
        #guidedPathNav li a::before { /* The dot visual */
            content: "";
            width: 10px;
            height: 10px;
            background-color: var(--border-color);
            border-radius: 50%;
            display: block;
            transition: background-color 0.3s ease, transform 0.3s ease;
        }

        #guidedPathNav li a.active::before {
            background-color: var(--accent-color);
            transform: scale(1.5); /* Enlarge active dot */
        }
        #guidedPathNav li a:hover::before {
            background-color: var(--highlight-color);
        }

        #guidedPathNav li a .nav-label { /* Tooltip-like label */
            visibility: hidden;
            opacity: 0;
            position: absolute;
            left: calc(var(--nav-width) + 5px); /* Position to the right of the nav */
            top: 50%;
            transform: translateY(-50%);
            background-color: var(--text-color);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8em;
            white-space: nowrap;
            transition: visibility 0.2s, opacity 0.2s ease-in-out;
        }

        #guidedPathNav:hover li a .nav-label,
        #guidedPathNav li a:focus .nav-label { /* Show label on nav hover or link focus */
            visibility: visible;
            opacity: 1;
        }


        /* Responsive Adjustments */
        @media (max-width: 900px) { /* Increased breakpoint for nav adjustment */
            body {
                padding-left: 0; /* Remove padding when nav is hidden/changed */
            }
            #guidedPathNav {
                /* Example: Hide nav on smaller screens, or transform to a hamburger.
                   For now, let's hide it. A real implementation would need a toggle. */
                display: none;
            }
            .container {
                max-width: 100%;
                padding: 15px;
            }
        }
        @media (max-width: 768px) {
            body { font-size: 16px; }
            h1 { font-size: 2em; }
            .hero-section { padding: 40px 15px; }
            .posture-assessor { flex-direction: column; }
            .posture-silhouette { width: 120px; margin: 0 auto; }
        }

    </style>
</head>
<body>

    <!-- "Guided Path" Navigation -->
    <nav id="guidedPathNav" aria-label="Page sections">
        <div id="pathLine"></div>
        <div id="pathMarker"></div>
        <ul>
            <!-- Links will be dynamically populated or manually added -->
            <li><a href="#introduction" data-section-id="introduction" aria-label="Introduction"><span class="nav-label">Introduction</span></a></li>
            <li><a href="#foundations" data-section-id="foundations" aria-label="Foundations"><span class="nav-label">Foundations</span></a></li>
            <li><a href="#preparation" data-section-id="preparation" aria-label="Preparation"><span class="nav-label">Preparation</span></a></li>
            <li><a href="#step-by-step-practice" data-section-id="step-by-step-practice" aria-label="Step-by-Step Practice"><span class="nav-label">Practice Guide</span></a></li>
            <li><a href="#troubleshooting" data-section-id="troubleshooting" aria-label="Troubleshooting"><span class="nav-label">Troubleshooting</span></a></li>
            <li><a href="#signs-of-progress" data-section-id="signs-of-progress" aria-label="Signs of Progress"><span class="nav-label">Progress</span></a></li>
            <li><a href="#integration-practices" data-section-id="integration-practices" aria-label="Integration"><span class="nav-label">Integration</span></a></li>
            <li><a href="#conclusion" data-section-id="conclusion" aria-label="Conclusion"><span class="nav-label">Conclusion</span></a></li>
        </ul>
    </nav>

    <header class="page-header">
        <p>An companion guide to the <a href="https://cheatsheets.davidveksler.com/buddhism.html" target="_blank">Core Buddhist Principles Cheatsheet</a>.</p>
    </header>

    <div class="hero-section">
        <h1>Your First Mindful Breath Starts Now</h1>
        <p>A practical guide to <span class="pali-term">Ānāpānasati<span class="tooltip-text">Mindfulness of breathing, a core meditation practice.</span></span> for clarity, calm, and insight.</p>
        <a href="#step-by-step-practice" class="cta-button">Start Guided Practice</a>
        <a href="#foundations" class="secondary-link">Explore the Foundations First</a>
    </div>

    <div class="container">

        <section id="introduction" class="content-section">
            <h2>Introduction</h2>
            <p>Welcome to the path of <span class="pali-term">Ānāpānasati<span class="tooltip-text">Mindfulness of breathing.</span></span>, or mindfulness of breathing. This practice is a cornerstone of Buddhist meditation, with deep roots and profound benefits.</p>
            <ul>
                <li>Origins in the Buddha's <span class="pali-term">Ānāpānasati Sutta<span class="tooltip-text">The Buddha's primary discourse on mindfulness of breathing.</span></span>.</li>
                <li>Central role in various Buddhist meditation traditions.</li>
                <li>Supported by growing scientific evidence for its positive impact on mental and physical well-being.</li>
            </ul>
        </section>

        <section id="foundations" class="content-section">
            <h2>Foundations</h2>
            <p>Understanding the framework of Ānāpānasati enriches the practice.</p>
            <ul>
                <li>The four tetrads: Guiding the observation of (1) body, (2) feelings, (3) mind, and (4) mental objects (<span class="pali-term">dhammas<span class="tooltip-text">Mental qualities, phenomena, principles.</span></span>).</li>
                <li>Relationship to the Four Foundations of Mindfulness (<span class="pali-term">Satipaṭṭhāna<span class="tooltip-text">The Four Foundations of Mindfulness: contemplation of body, feelings, mind, and mental objects.</span></span>).</li>
                <li>How Ānāpānasati develops both <span class="pali-term">samatha<span class="tooltip-text">Calm, concentration.</span></span> (calm) and <span class="pali-term">vipassanā<span class="tooltip-text">Insight, clear seeing.</span></span> (insight).</li>
            </ul>
        </section>

        <section id="preparation" class="content-section">
            <h2>Preparation: Setting the Stage for Calm</h2>
            <p>A conducive environment and posture support your practice.</p>

            <div class="posture-assessor">
                <div class="posture-silhouette" aria-hidden="true">
                    <svg viewBox="0 0 100 150" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="50" cy="20" r="10" fill="#ccc"/>
                        <rect x="40" y="30" width="20" height="50" fill="#ccc"/>
                        <ellipse cx="50" cy="90" rx="30" ry="15" fill="#ccc"/>
                        <rect x="20" y="100" width="60" height="10" fill="#ccc"/>
                         <title>Meditating Figure Silhouette</title>
                    </svg>
                    <div class="hotspot head" data-tip="head-tip" aria-label="Head posture tip"></div>
                    <div class="hotspot shoulders" data-tip="shoulders-tip" aria-label="Shoulders posture tip"></div>
                    <div class="hotspot spine" data-tip="spine-tip" aria-label="Spine posture tip"></div>
                    <div class="hotspot hands" data-tip="hands-tip" aria-label="Hands posture tip"></div>
                </div>
                <div class="posture-tips">
                    <p><strong>Optimal Sitting Postures:</strong> Aim for stability and ease. Common options include:</p>
                    <ul>
                        <li>Burmese (legs crossed, both feet on floor)</li>
                        <li>Half Lotus / Full Lotus (if comfortable without strain)</li>
                        <li>Seiza (kneeling, using a cushion or bench)</li>
                        <li>Chair (feet flat, back unsupported or gently supported)</li>
                    </ul>
                    <div id="head-tip" class="posture-tip" style="display:none;"><strong>Head:</strong> Slightly tilted down, as if gazing a few feet ahead. Chin gently tucked.</div>
                    <div id="shoulders-tip" class="posture-tip" style="display:none;"><strong>Shoulders:</strong> Relaxed, level, and slightly back, opening the chest. Avoid hunching.</div>
                    <div id="spine-tip" class="posture-tip" style="display:none;"><strong>Back:</strong> Straight but not stiff, maintaining natural curvature. Imagine being gently pulled up from the crown.</div>
                    <div id="hands-tip" class="posture-tip" style="display:none;"><strong>Hands:</strong> Rest gently in the lap, one on top of the other, palms up (<span class="pali-term">dhyāna mudrā<span class="tooltip-text">Meditation gesture, often with thumbs lightly touching.</span></span>), or on the knees.</div>
                </div>
            </div>

            <h4>Creating a Distraction-Free Environment</h4>
            <ul>
                <li>Choose a quiet space where you're unlikely to be disturbed.</li>
                <li>Minimize clutter. A simple, dedicated space can be helpful.</li>
                <li>Inform household members if necessary.</li>
            </ul>

            <h4>Eyes: Half-Closed vs. Closed</h4>
            <ul>
                <li><strong>Closed:</strong> Can reduce visual distraction, good for turning inward. May lead to drowsiness for some.</li>
                <li><strong>Half-Closed (or soft gaze):</strong> Gaze softly downwards a few feet in front. Helps maintain alertness. Common in Zen.</li>
                <li>Experiment to see what works best for you.</li>
            </ul>
        </section>

        <div class="breath-pacer-container">
            <h3>Optional: Gentle Breath Pacer</h3>
            <div class="breath-pacer-visual" id="breathPacerVisual"></div>
            <p class="subtle-text">Observe the rhythm. Let it guide your breath if helpful.</p>
            <div class="breath-pacer-controls">
                <button id="playPacer">Play</button>
                <button id="pausePacer">Pause</button>
            </div>
            <p class="subtle-text">This is a visual guide. Your natural breath is always right.</p>
        </div>

        <section id="step-by-step-practice" class="content-section">
            <h2>Step-by-Step Practice Guide</h2>
            <p>This guide breaks down the practice into manageable stages. Adjust timings to suit your experience.</p>
            <article><h3>1. Initial Setup (Approx. 5 minutes)</h3></article>
            <article><h3>2. Establishing Awareness (Approx. 5-10 minutes)</h3></article>
            <article><h3>3. Core Practice (Approx. 15-45 minutes)</h3></article>
            <article id="sixteen-steps"><h3>4. The 16 Steps of Ānāpānasati (Progressive Deepening)</h3></article>
            <!-- ... (rest of the step-by-step content as before) ... -->
        </section>

        <section id="troubleshooting" class="content-section">
            <h2>Troubleshooting Common Challenges</h2>
            <!-- ... (troubleshooting content as before) ... -->
        </section>

        <section id="signs-of-progress" class="content-section">
            <h2>Signs of Progress</h2>
            <!-- ... (signs of progress content as before) ... -->
        </section>

        <section id="progressive-schedule" class="content-section">
            <h2>Progressive Training Schedule (Suggested)</h2>
            <!-- ... (schedule content as before) ... -->
        </section>

        <section id="integration-practices" class="content-section">
            <h2>Integration Practices: Bringing Mindfulness into Daily Life</h2>
            <!-- ... (integration content as before) ... -->
        </section>

        <section id="technical-aspects" class="content-section">
            <h2>Technical Aspects (Brief Overview)</h2>
            <!-- ... (technical aspects content as before) ... -->
        </section>

        <section id="resources" class="content-section">
            <h2>Resources</h2>
            <!-- ... (resources content as before) ... -->
        </section>

        <section id="conclusion" class="content-section">
            <h2>Conclusion: Your Ongoing Journey</h2>
            <!-- ... (conclusion content as before, ensure Pāli terms are correctly wrapped) ... -->
            <p class="text-center" style="margin-top: 30px;"><em>May your practice bring peace and understanding.</em></p>
        </section>
    </div>

    <footer class="page-footer">
        <p>&copy; 2025 Practical Guide to Ānāpānasati. Information inspired by traditional teachings and modern understanding.
            <br>This guide is for informational purposes and does not replace guidance from a qualified teacher.
        </p>
        <p><a href="https://cheatsheets.davidveksler.com/" target="_blank">Back to All Cheatsheets</a></p>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        // --- Posture Assessor Hotspots ---
        const hotspots = document.querySelectorAll('.posture-assessor .hotspot');
        const postureTips = {
            'head-tip': document.getElementById('head-tip'),
            'shoulders-tip': document.getElementById('shoulders-tip'),
            'spine-tip': document.getElementById('spine-tip'),
            'hands-tip': document.getElementById('hands-tip')
        };
        let activePostureTip = null;
        hotspots.forEach(hotspot => {
            const tipId = hotspot.dataset.tip;
            const tipElement = postureTips[tipId];
            if (tipElement) {
                hotspot.addEventListener('mouseover', () => {
                    if (activePostureTip) activePostureTip.style.display = 'none';
                    tipElement.style.display = 'block';
                    activePostureTip = tipElement;
                });
            }
        });
        document.addEventListener('click', function(event) {
            const postureAssessor = document.querySelector('.posture-assessor');
            if (activePostureTip && postureAssessor && !postureAssessor.contains(event.target)) {
                activePostureTip.style.display = 'none';
                activePostureTip = null;
            }
        });

        // --- Breath Pacer Controls ---
        const breathPacerVisual = document.getElementById('breathPacerVisual');
        const playPacerBtn = document.getElementById('playPacer');
        const pausePacerBtn = document.getElementById('pausePacer');
        let pacerAnimationState = 'running';

        if (breathPacerVisual) {
            breathPacerVisual.style.animationPlayState = 'running';
            breathPacerVisual.textContent = "Inhale...";
            // Simplified text change based on CSS animation timing
            const pacerCycleTime = 8000; // 8s animation
            let pacerInterval;
            function updatePacerText() {
                 if (pacerAnimationState === 'running') {
                    breathPacerVisual.textContent = "Inhale...";
                    setTimeout(() => {
                        if (pacerAnimationState === 'running') breathPacerVisual.textContent = "Exhale...";
                    }, pacerCycleTime / 2);
                }
            }
            function startPacerInterval() {
                updatePacerText(); // Initial call
                pacerInterval = setInterval(updatePacerText, pacerCycleTime);
            }
            function stopPacerInterval() {
                 clearInterval(pacerInterval);
            }
            startPacerInterval();


            if (playPacerBtn) {
                playPacerBtn.addEventListener('click', () => {
                    breathPacerVisual.style.animationPlayState = 'running';
                    pacerAnimationState = 'running';
                    stopPacerInterval(); // Clear existing before starting new
                    startPacerInterval();
                });
            }
            if (pausePacerBtn) {
                pausePacerBtn.addEventListener('click', () => {
                    breathPacerVisual.style.animationPlayState = 'paused';
                    pacerAnimationState = 'paused';
                    breathPacerVisual.textContent = "Paused";
                    stopPacerInterval();
                });
            }
        }

        // --- "Guided Path" Navigation Logic ---
        const nav = document.getElementById('guidedPathNav');
        const pathMarker = document.getElementById('pathMarker');
        const navLinks = nav.querySelectorAll('ul li a');
        const sections = Array.from(navLinks).map(link => {
            const sectionId = link.getAttribute('href').substring(1);
            return document.getElementById(sectionId);
        }).filter(section => section !== null); // Filter out nulls if section not found

        const navList = nav.querySelector('ul');
        const pathLine = document.getElementById('pathLine');

        function updateMarkerAndActiveLink() {
            if (!navList || !pathMarker || sections.length === 0) return;

            let currentSectionId = null;
            const scrollPosition = window.scrollY + window.innerHeight / 2; // Consider middle of viewport

            sections.forEach(section => {
                if (section.offsetTop <= scrollPosition && (section.offsetTop + section.offsetHeight) > scrollPosition) {
                    currentSectionId = section.id;
                }
            });
             // If no section is perfectly in the middle (e.g., at the very top or bottom of page),
             // find the closest one from the top.
            if (!currentSectionId && sections.length > 0) {
                for (let i = sections.length - 1; i >= 0; i--) {
                    if (sections[i].offsetTop <= window.scrollY + 100) { // 100px threshold from top
                        currentSectionId = sections[i].id;
                        break;
                    }
                }
                 if (!currentSectionId) currentSectionId = sections[0].id; // Default to first if nothing else
            }


            let activeLinkIndex = -1;
            navLinks.forEach((link, index) => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${currentSectionId}`) {
                    link.classList.add('active');
                    activeLinkIndex = index;
                }
            });

            // Position marker
            if (activeLinkIndex !== -1 && navLinks[activeLinkIndex]) {
                const activeNavLink = navLinks[activeLinkIndex];
                // Calculate position relative to the navList, considering its own offset
                const navListRect = navList.getBoundingClientRect();
                const linkRect = activeNavLink.getBoundingClientRect();

                // The marker should align with the center of the dot (a::before)
                // The dot is centered within the <a> tag.
                const markerTop = (linkRect.top - navListRect.top) + (linkRect.height / 2) - (pathMarker.offsetHeight / 2);
                pathMarker.style.top = `${markerTop}px`;

            } else if (sections.length > 0 && navLinks.length > 0) {
                 // Default to first if no active link (e.g. page load before scroll)
                const firstLink = navLinks[0];
                firstLink.classList.add('active');
                const firstLinkRect = firstLink.getBoundingClientRect();
                const navListRect = navList.getBoundingClientRect();
                const markerTop = (firstLinkRect.top - navListRect.top) + (firstLinkRect.height / 2) - (pathMarker.offsetHeight / 2);
                pathMarker.style.top = `${markerTop}px`;
            }
        }

        // Smooth scroll for all anchor links, including guided path and hero CTA
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                const href = this.getAttribute('href');
                if (href.length > 1 && document.querySelector(href)) {
                    e.preventDefault();
                    const targetElement = document.querySelector(href);
                    // Calculate scroll position to align target element slightly below the top of viewport
                    // This prevents it from being hidden under a fixed header if one existed.
                    // For this layout, scrolling to top of section is fine.
                    const offsetTop = targetElement.offsetTop;

                    window.scrollTo({
                        top: offsetTop - 20, // Small offset for better visibility
                        behavior: 'smooth'
                    });

                    // Manually update active state for guided path if clicked
                    if (this.closest('#guidedPathNav')) {
                        navLinks.forEach(link => link.classList.remove('active'));
                        this.classList.add('active');
                        updateMarkerAndActiveLink(); // Recalculate marker immediately
                    }
                }
            });
        });

        window.addEventListener('scroll', updateMarkerAndActiveLink);
        window.addEventListener('resize', updateMarkerAndActiveLink); // Recalculate on resize

        // Initial call to set marker and active link
        updateMarkerAndActiveLink();

        console.log("Ānāpānasati Cheatsheet Enhanced Initialized.");
    });
    </script>

</body>
</html>