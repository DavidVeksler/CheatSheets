<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Interactive AI Safety Ecosystem Hub (List &amp; Map)</title>
<link href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text y=%22.9em%22 font-size=%2290%22&gt;🛡️&lt;/text&gt;&lt;/svg&gt;" rel="icon"/>
<meta content="Explore the AI Safety ecosystem: A comprehensive, interactive directory and visual map of labs, research groups, policy orgs, funding, and resources. Toggle between list and map views." name="description"/>
<!-- ====== Open Graph / Facebook Meta Tags ====== -->
<meta content="website" property="og:type"/>
<meta content="https://cheatsheets.davidveksler.com/aisafety.html" property="og:url"/> <!-- Replace with the actual URL of your page -->
<meta content="Interactive AI Safety Ecosystem Hub (List &amp; Map)" property="og:title"/> <!-- The title shown in the share preview -->
<meta content="Explore labs, research, policy, funding &amp; resources in the AI Safety field via an interactive list and map." property="og:description"/> <!-- Short, catchy description -->
<meta content="https://aisafety.davidveksler.com/ai-safety-ecosystem-preview.png" property="og:image"/> <!-- Replace with the FULL URL to your preview image -->
<meta content="1200" property="og:image:width"/> <!-- Optional: Specify image width -->
<meta content="630" property="og:image:height"/> <!-- Optional: Specify image height -->
<!-- <meta property="og:site_name" content="Your Site Name"> --> <!-- Optional: If your hub is part of a larger site -->
<!-- ====== Twitter Card Meta Tags ====== -->
<meta content="summary_large_image" name="twitter:card"/> <!-- Use "summary_large_image" for the 1200x630 image -->
<meta content="https://aisafety.davidveksler.com" name="twitter:url"/> <!-- Replace with the actual URL of your page -->
<meta content="Interactive AI Safety Ecosystem Hub (List &amp; Map)" name="twitter:title"/> <!-- Title for Twitter shares -->
<meta content="Explore labs, research, policy, funding &amp; resources in the AI Safety field via an interactive list and map." name="twitter:description"/> <!-- Description for Twitter shares -->
<meta content="https://aisafety.davidveksler.com/ai-safety-ecosystem-preview.png" name="twitter:image"/> <!-- Replace with the FULL URL to your preview image -->
<!-- <meta name="twitter:site" content="@YourTwitterHandle"> --> <!-- Optional: Your site's Twitter handle -->
<meta content="@HeroicLife" name="twitter:creator"/>
<!-- ====== Other Optional Meta Tags ====== -->
<link href="https://cheatsheets.davidveksler.com/aisafety.html" rel="canonical"/> <!-- Important for SEO: The preferred URL -->
<title>Interactive AI Safety Ecosystem Hub (List &amp; Map)</title>
<!-- Bootstrap CSS -->
<link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" rel="stylesheet"/>
<!-- Bootstrap Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet"/>
<!-- D3.js -->
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
        html, body {
            height: 100%;
            overflow: hidden; /* Prevent body scrollbars when map is active */
        }
        body {
            display: flex;
            flex-direction: column;
            background-color: #f0f2f5;
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", "Noto Sans", "Liberation Sans", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"; /* Bootstrap's font stack */
        }
        header {
            background-color: #087990;
            color: white;
            padding: 0.75rem 1rem;
            flex-shrink: 0;
        }
        header h4 {
            margin: 0;
            font-size: 1.25rem;
        }
        /* Main container for tabs and content */
        .main-content-area {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Contain tab content */
            padding: 1rem; /* Add some padding around tab area */
            padding-bottom: 0;
        }
         /* Tab Styling */
        .nav-tabs {
            border-bottom: 1px solid #dee2e6;
            flex-shrink: 0; /* Prevent tabs from shrinking */
        }
        .nav-tabs .nav-link {
            color: #495057;
            border-radius: 0.375rem 0.375rem 0 0;
            padding: 0.75rem 1.25rem;
            font-weight: 500;
            background-color: #e9ecef; /* Lighter background for inactive tabs */
            border-color: transparent; /* Cleaner look for inactive */
        }
        .nav-tabs .nav-link.active {
            color: #087990;
            background-color: #fff; /* Make active tab bg white */
            border-color: #dee2e6 #dee2e6 #fff; /* Connect border */
        }
        .nav-tabs .nav-link:hover:not(.active) {
            border-color: #e9ecef #e9ecef #dee2e6;
            background-color: #f8f9fa; /* Slightly lighter hover */
        }
        .tab-content {
            flex-grow: 1;
            overflow: hidden; /* Important for child height */
            background-color: #fff; /* White background for content */
            border: 1px solid #dee2e6; /* Border around content */
            border-top: none;
            border-radius: 0 0 0.375rem 0.375rem;
        }
        .tab-pane {
            height: 100%;
            overflow: hidden; /* Children must handle own scrolling */
            display: flex; /* Use flex for map layout */
            flex-direction: column; /* Default for list view */
        }
        .tab-pane.active {
            display: flex; /* Override Bootstrap's default block */
        }

        /* --- List View Styling --- */
        #list-view-pane { /* The container for the scrolling list */
             overflow-y: auto;
        }
        #list-view { /* The inner content div */
             padding: 1.5rem;
        }
        /* --- Category Navigation (List View) --- */
        #category-nav {
            display: flex;
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
            gap: 0.5rem; /* Spacing between links */
            padding: 0.75rem 1rem;
            background-color: #f8f9fa; /* Light background */
            border: 1px solid #dee2e6;
            margin-bottom: 1.5rem; /* Space below nav */
            border-radius: 0.375rem;
        }
        .category-link {
            text-decoration: none;
            padding: 0.35rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-flex; /* Align icon and text */
            align-items: center;
            gap: 0.3rem; /* Space between icon and text */
            border: 1px solid transparent;
            transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;
            color: #343a40; /* Default text color */
            background-color: #e9ecef; /* Default background */
            border-color: #dee2e6;
        }
        .category-link:hover {
            background-color: #d3d9df;
            border-color: #adb5bd;
            color: #000;
        }
        .category-link i {
            font-size: 0.9em;
            vertical-align: middle; /* Adjusted for flex align */
            line-height: 1; /* Ensure consistent height */
        }
        /* Add category-specific colors using border - safer for accessibility */
        /* Map View uses background colors, Nav uses border */
        .cat-color-labs { border-left: 4px solid #dc3545; }
        .cat-color-academic { border-left: 4px solid #fd7e14; }
        .cat-color-policy { border-left: 4px solid #ffc107; }
        .cat-color-advocacy { border-left: 4px solid #20c997; }
        .cat-color-info { border-left: 4px solid #0dcaf0; }
        .cat-color-funding { border-left: 4px solid #198754; }
        .cat-color-field { border-left: 4px solid #0d6efd; }
        .cat-color-community { border-left: 4px solid #6f42c1; }
        .cat-color-forecasting { border-left: 4px solid #d63384; }
        .cat-color-inactive { border-left: 4px solid #6c757d; }


        #list-view h2 {
            color: #087990;
            border-bottom: 2px solid #e0f2f7;
            padding-bottom: 0.5rem;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            font-size: 1.5rem;
            scroll-margin-top: 70px; /* Offset for fixed headers or nav */
        }
        #list-view h2:first-of-type {
            margin-top: 0; /* No top margin for the very first header */
        }
        .importance-legend {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background-color: #e9ecef;
            border-radius: 0.375rem;
            border: 1px solid #dee2e6;
        }
         .importance-legend span { margin-right: 10px; white-space: nowrap; }
         .importance-legend .badge { font-size: 0.8em; padding: 0.35em 0.6em; color: #fff; font-weight: bold; vertical-align: middle; }

         /* Card styles */
        .card { margin-bottom: 1.5rem; border: none; box-shadow: 0 3px 7px rgba(0, 0, 0, 0.08); display: flex; flex-direction: column; height: 100%; transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1); }
        .card-body { display: flex; flex-direction: column; flex-grow: 1; padding: 1rem; } /* Standard padding */
        .card-title { margin-bottom: 0; flex-grow: 1; min-width: 0; /* Allow shrinking */ display: flex; align-items: baseline; /* Align badge nicely */ flex-wrap: wrap; /* Allow wrapping if needed */ gap: 0 0.5rem; /* Horizontal gap for badge */ }
        .card-title a { text-decoration: none; color: #0b5c6e; font-weight: 600; font-size: 1rem; /* Slightly smaller titles */ }
        .card-title a:hover { text-decoration: underline; }
        .card-text { margin-bottom: 0.75rem; font-size: 0.875rem; /* Smaller card text */ line-height: 1.6; color: #495057; }
        .category-info { margin-bottom: 0.75rem; display: flex; align-items: center; }
        .category-icon { font-size: 0.9rem; margin-right: 0.4rem; color: #6c757d; vertical-align: middle; flex-shrink: 0; line-height: 1; /* Consistency */ }
        .category-text { font-size: 0.75rem; color: #6c757d; font-style: italic; vertical-align: middle; }
        .importance-badge { font-size: 0.7em; padding: 0.3em 0.55em; vertical-align: baseline; color: #fff; font-weight: bold; border-radius: 0.375rem; line-height: 1; }
        .imp-1 { background-color: #adb5bd; } .imp-2 { background-color: #5fa8d3; } .imp-3 { background-color: #1a9988; } .imp-4 { background-color: #f7b801; } .imp-5 { background-color: #f25c54; }
        .inactive-card { opacity: 0.75; background-color: #e9ecef !important; }
        .inactive-card .card-title a { color: #6c757d !important; }
         /* AI Lab specific */
        .title-logo-container { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; gap: 10px; }
        .ai-lab-logo { max-height: 30px; max-width: 90px; margin-left: 10px; object-fit: contain; vertical-align: middle; flex-shrink: 0; }
        .safety-links { margin-top: auto; padding-top: 0.5rem; border-top: 1px solid #eee; font-size: 0.75rem; line-height: 1.6; } /* Changed margin-top to auto */
        .safety-links a { color: #555; text-decoration: none; margin-right: 10px; display: inline-block; white-space: nowrap; }
        .safety-links a:hover { color: #087990; text-decoration: underline; }
        .safety-links i { margin-right: 3px; vertical-align: middle; font-size: 0.9em; }


        /* --- Map View Styling --- */
        #map-view-pane { /* The container for map + controls */
             flex-direction: row; /* Side-by-side */
        }
        #controls-container {
            width: 280px; /* Fixed width for controls */
            flex-shrink: 0;
            padding: 1rem;
            background-color: #e9ecef;
            border-right: 1px solid #dee2e6;
            overflow-y: auto;
            height: 100%;
        }
        #map-container {
            flex-grow: 1;
            position: relative;
            overflow: hidden;
            height: 100%;
            background-color: #ffffff;
        }
        #map-svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: grab; }
        #map-svg:active { cursor: grabbing; }

        /* D3 Node Styling */
        .node circle { stroke: rgba(0,0,0,0.2); stroke-width: 0.5px; transition: transform 0.1s ease-out, stroke 0.1s ease-out; }
        .node:hover circle { stroke: #333; stroke-width: 1px; }
        .node { filter: url(#drop-shadow); transition: filter 0.2s ease-out; } /* Smooth filter change */
        .node text.node-label { font-size: 9px; fill: #333; text-anchor: middle; pointer-events: none; paint-order: stroke; stroke: rgba(255,255,255,0.7); stroke-width: 2.5px; stroke-linecap: butt; stroke-linejoin: miter; }
        .node text.node-icon { font-family: 'bootstrap-icons'; font-size: 12px; fill: rgba(0, 0, 0, 0.5); text-shadow: 0px 0px 2px rgba(255, 255, 255, 0.7); text-anchor: middle; dominant-baseline: central; pointer-events: none; }
        .node.selected { filter: url(#drop-shadow-selected); }
        .node.selected circle { stroke: #087990; stroke-width: 2px; }
        .node.selected text.node-label { font-weight: bold; fill: #000; stroke: rgba(255,255,255,0.8); }
        .node.selected text.node-icon { fill: rgba(0, 0, 0, 0.7); }

        /* Tooltip Styling */
        #tooltip { position: absolute; background-color: rgba(0, 0, 0, 0.85); color: white; padding: 8px 12px; border-radius: 4px; font-size: 0.85rem; pointer-events: none; opacity: 0; transition: opacity 0.2s; white-space: normal; /* Allow wrap */ z-index: 10; box-shadow: 0 2px 5px rgba(0,0,0,0.2); max-width: 250px; /* Limit width */ }
        #tooltip strong { display: block; margin-bottom: 3px; font-weight: 600; }
        #tooltip .tooltip-details { font-size: 0.75rem; opacity: 0.9; margin-bottom: 4px; }
        #tooltip .tooltip-desc { font-size: 0.75rem; opacity: 0.8; font-style: italic; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; /* Truncate description */ }

        /* Info Panel Styling (Sidebar) */
        #controls-container h5 { font-size: 1rem; margin-bottom: 0.75rem; color: #343a40; padding-top: 0.5rem; }
        #controls-container hr { margin: 1rem 0;} /* Consistent spacing */
        #info-panel { padding: 1rem; background-color: #fff; border-radius: 0.375rem; border: 1px solid #dee2e6; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: none; /* Hidden by default */ margin-top: 0; /* Remove top margin here */ }
        #info-panel h5 { font-size: 1.1rem; color: #087990; margin-bottom: 0.75rem; margin-top: 0; }
        #info-panel p { font-size: 0.85rem; margin-bottom: 0.5rem; }
        #info-panel .badge { vertical-align: baseline; margin-left: 5px; }
        #info-panel a.external-link { font-size: 0.85rem; word-break: break-all; }
        #info-panel #info-safety-links { margin-top: 0.75rem; padding-top: 0.5rem; border-top: 1px solid #eee; }
        #info-panel #info-safety-links h6 { font-size: 0.85rem; margin-bottom: 0.3rem; color: #555; }
        #info-panel #info-safety-links a { display: block; margin-bottom: 0.2rem; font-size: 0.8rem; color: #0b5c6e; }
         #info-panel #info-safety-links a:hover { text-decoration: underline; }
        #info-panel #info-safety-links i { font-size: 0.9em; margin-right: 4px; color: #6c757d; }

        /* Filter & Legend Styling */
        #filter-controls .form-check { margin-bottom: 0.3rem; }
        #filter-controls .form-check-label { font-size: 0.85rem; }
        #legend .legend-item { display: flex; align-items: center; margin-bottom: 0.25rem; font-size: 0.85rem; }
        .legend-color-box { width: 15px; height: 15px; margin-right: 8px; border: 1px solid #ccc; display: inline-flex; align-items: center; justify-content: center; flex-shrink: 0; border-radius: 50%; }
        .legend-color-box i { font-size: 10px; color: rgba(0, 0, 0, 0.6); text-shadow: 0px 0px 1px rgba(255, 255, 255, 0.5); }
        .legend-item span:last-child { margin-left: 5px; }

        /* Loading Spinner */
        .spinner-container { padding: 3rem; text-align: center; }

    </style>
</head>
<body>
<header>
<h4><i class="bi bi-shield-check"></i> Interactive AI Safety Ecosystem Hub</h4>
</header>
<div class="main-content-area">
<!-- Tab Navigation -->
<ul class="nav nav-tabs" id="viewTab" role="tablist">
<li class="nav-item" role="presentation">
<button aria-controls="list-view-pane" aria-selected="true" class="nav-link active" data-bs-target="#list-view-pane" data-bs-toggle="tab" id="list-tab" role="tab" type="button">
<i class="bi bi-list-ul"></i> List View
                </button>
</li>
<li class="nav-item" role="presentation">
<button aria-controls="map-view-pane" aria-selected="false" class="nav-link" data-bs-target="#map-view-pane" data-bs-toggle="tab" id="map-tab" role="tab" type="button">
<i class="bi bi-diagram-3"></i> Map View
                </button>
</li>
</ul>
<!-- Tab Content -->
<div class="tab-content" id="viewTabContent">
<!-- List View Pane -->
<div aria-labelledby="list-tab" class="tab-pane fade show active" id="list-view-pane" role="tabpanel" tabindex="0">
<div id="list-view">
<!-- Category Navigation -->
<nav id="category-nav">
<a class="category-link cat-color-labs" href="#list-ai-lab" title="Jump to the Major AI Labs section"><i class="bi bi-robot"></i> AI Labs</a>
<a class="category-link cat-color-academic" href="#list-academic-research" title="Jump to the Academic &amp; Independent Research Groups section"><i class="bi bi-mortarboard-fill"></i> Academic/Research</a>
<a class="category-link cat-color-policy" href="#list-policy-gov" title="Jump to the Policy, Governance &amp; Strategy Organizations section"><i class="bi bi-building-gear"></i> Policy/Gov</a>
<a class="category-link cat-color-advocacy" href="#list-advocacy" title="Jump to the Advocacy &amp; Public Awareness Groups section"><i class="bi bi-megaphone-fill"></i> Advocacy</a>
<a class="category-link cat-color-info" href="#list-info-media" title="Jump to the Information Hubs, Media &amp; Foundational Resources section"><i class="bi bi-broadcast-pin"></i> Info/Media</a>
<a class="category-link cat-color-funding" href="#list-funding" title="Jump to the Funding &amp; Philanthropy section"><i class="bi bi-cash-stack"></i> Funding</a>
<a class="category-link cat-color-field" href="#list-field-building" title="Jump to the Field Building, Education &amp; Career Support section"><i class="bi bi-person-workspace"></i> Field Building</a>
<a class="category-link cat-color-community" href="#list-community-infra" title="Jump to the Community Infrastructure &amp; Research Support section"><i class="bi bi-diagram-3-fill"></i> Community/Infra</a>
<a class="category-link cat-color-forecasting" href="#list-forecasting" title="Jump to the Forecasting section"><i class="bi bi-graph-up-arrow"></i> Forecasting</a>
<a class="category-link cat-color-inactive" href="#list-inactive" title="Jump to the Inactive / Defunct Resources section"><i class="bi bi-slash-circle-fill"></i> Inactive</a>
</nav>
<!-- Legend for List View -->
<div class="importance-legend">
<strong>Importance Score Legend (Subjective Ecosystem Impact):</strong><br class="d-sm-none"/> <!-- Break on small screens -->
<span class="badge imp-5">5=Essential/Major Player</span>
<span class="badge imp-4">4=Highly Influential/Key Resource</span>
<span class="badge imp-3">3=Significant Contributor</span>
<span class="badge imp-2">2=Relevant/Niche</span>
<span class="badge imp-1">1=Supplementary/Inactive/Niche</span>
<br/><small class="text-muted d-block mt-1">Score reflects perceived impact/centrality within the broader AI Safety ecosystem.</small>
</div>
<div id="list-view-content">
<div class="spinner-container">
<div class="spinner-border text-primary" role="status">
<span class="visually-hidden">Loading...</span>
</div>
<p class="mt-2">Loading Resources...</p>
</div>
</div>
</div>
</div>
<!-- Map View Pane -->
<div aria-labelledby="map-tab" class="tab-pane fade" id="map-view-pane" role="tabpanel" tabindex="0">
<div id="controls-container">
<h5><i class="bi bi-filter"></i> Filter by Category</h5>
<div id="filter-controls"> <!-- Populated by JS --> </div>
<hr/>
<h5><i class="bi bi-palette"></i> Legend</h5>
<div id="legend"> <!-- Populated by JS --> </div>
<hr/>
<div id="info-panel"> <!-- Populated on click -->
<h5 id="info-name">Select a Node</h5>
<p><strong>Category:</strong> <span id="info-category"></span></p>
<p><strong>Importance:</strong> <span id="info-importance"></span></p>
<p><strong>Description:</strong> <span id="info-description">...</span></p>
<p><a class="external-link" href="#" id="info-link" rel="noopener noreferrer" target="_blank">Visit Website <i class="bi bi-box-arrow-up-right small"></i></a></p>
<div id="info-safety-links">
<!-- AI Lab Safety Links added here -->
</div>
</div>
<hr/>
<small class="text-muted">Hover for details. Click nodes for sidebar info. Zoom/Pan the map. Use filters.</small>
</div>
<div id="map-container">
<svg id="map-svg">
<defs>
<!-- Drop Shadow Filters -->
<filter height="200%" id="drop-shadow" width="200%" x="-50%" y="-50%"> <fegaussianblur in="SourceAlpha" result="blur" stddeviation="2"></fegaussianblur> <feoffset dx="2" dy="2" in="blur" result="offsetBlur"></feoffset> <feflood flood-color="#333" flood-opacity="0.4" result="offsetColor"></feflood> <fecomposite in="offsetColor" in2="offsetBlur" operator="in" result="offsetBlurColored"></fecomposite> <femerge> <femergenode in="offsetBlurColored"></femergenode> <femergenode in="SourceGraphic"></femergenode> </femerge> </filter>
<filter height="200%" id="drop-shadow-selected" width="200%" x="-50%" y="-50%"> <fegaussianblur in="SourceAlpha" result="blur" stddeviation="3"></fegaussianblur> <feoffset dx="3" dy="3" in="blur" result="offsetBlur"></feoffset> <feflood flood-color="#000" flood-opacity="0.5" result="offsetColor"></feflood> <fecomposite in="offsetColor" in2="offsetBlur" operator="in" result="offsetBlurColored"></fecomposite> <femerge> <femergenode in="offsetBlurColored"></femergenode> <femergenode in="SourceGraphic"></femergenode> </femerge> </filter>
<!-- Radial Gradients added by JS -->
</defs>
</svg>
<div id="tooltip"></div> <!-- Tooltip Div -->
</div>
</div>
</div>
</div>
<!-- Bootstrap JS Bundle -->
<script crossorigin="anonymous" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Load the external data -->
<script src="safety_data.js"></script>
<!-- Main Application Logic -->
<script>
    // --- Icon Mapping ---
    const categoryIcons = {
        "AI Lab": "bi-robot",
        "Academic/Research": "bi-mortarboard-fill",
        "Policy/Gov": "bi-building-gear",
        "Advocacy": "bi-megaphone-fill",
        "Info/Media": "bi-broadcast-pin",
        "Funding": "bi-cash-stack",
        "Field Building": "bi-person-workspace",
        "Community/Infra": "bi-diagram-3-fill",
        "Forecasting": "bi-graph-up-arrow",
        "Inactive": "bi-slash-circle-fill"
    };

    // --- Process Data from data.js ---
    // Check if raw data loaded, otherwise use an empty array to avoid errors
    const aiSafetyData = (typeof rawAiSafetyData !== 'undefined' ? rawAiSafetyData : []).map(node => ({
        ...node,
        // Ensure icon exists, default if not
        icon: categoryIcons[node.category] || 'bi-question-circle',
        // Create a unique ID for the card element in the list view
        cardId: `card-${node.id.replace(/[^a-zA-Z0-9]/g, '-')}`, // Basic slugify
        // Ensure importance is a number, default to a mid-value if invalid/missing
        importance: (typeof node.importance === 'number' && node.importance >= 1 && node.importance <= 5) ? node.importance : 3,
        // Ensure subCategoryIcon and subCategoryText are present, even if null/undefined initially
        subCategoryIcon: node.subCategoryIcon || null,
        subCategoryText: node.subCategoryText || null
    }));


    // --- Global Variables & Constants ---
    const categoryOrder = ["AI Lab", "Academic/Research", "Policy/Gov", "Advocacy", "Info/Media", "Funding", "Field Building", "Community/Infra", "Forecasting", "Inactive"];
    const categoryColors = {
        "AI Lab": "#dc3545",
        "Academic/Research": "#fd7e14",
        "Policy/Gov": "#ffc107",
        "Advocacy": "#20c997",
        "Info/Media": "#0dcaf0",
        "Funding": "#198754",
        "Field Building": "#0d6efd",
        "Community/Infra": "#6f42c1",
        "Forecasting": "#d63384",
        "Inactive": "#6c757d"
    };
    let mapRendered = false; // Flag to track if map has been initially rendered
    let categoryCenters = {}; // To store cluster center coordinates


    // --- Core Rendering Functions ---

    function renderListView(data) {
        const container = document.getElementById('list-view-content');
        if (!container) { console.error("List view container not found"); return; }
        container.innerHTML = ''; // Clear previous content/spinner

        // Check if data is empty after processing
        if (!data || data.length === 0) {
             if (typeof rawAiSafetyData === 'undefined') {
                  container.innerHTML = '<p class="text-danger text-center">Error: Could not load data from data.js.</p>';
             } else {
                  container.innerHTML = '<p class="text-muted text-center">No AI Safety data to display.</p>';
             }
             return; // Stop execution if no data
        }

        categoryOrder.forEach(category => {
            const categoryData = data.filter(item => item.category === category);
            if (categoryData.length === 0) return;

            const section = document.createElement('section');
            // Generate ID matching the navigation hrefs (e.g., list-ai-lab)
            section.id = `list-${category.toLowerCase().replace(/[^a-z0-9]+/g, '-')}`;
            const header = document.createElement('h2');
            header.className = 'mb-4';
            // Use the main category icon for the list view header as well
            header.innerHTML = `<i class="${categoryIcons[category] || 'bi-question-circle'} category-icon"></i> ${category}`;
            section.appendChild(header);

            const row = document.createElement('div');
            row.className = 'row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4'; // Adjusted grid for potentially more columns on XL
            section.appendChild(row);

            // Sort items within the category by importance (descending, so 5 is higher) then name
            categoryData.sort((a, b) => {
                if (a.importance !== b.importance) {
                    // Higher importance number should come first
                    return b.importance - a.importance;
                }
                return a.name.localeCompare(b.name); // Then alphabetically
            });


            categoryData.forEach(item => {
                const col = document.createElement('div');
                col.className = 'col d-flex align-items-stretch'; // Make columns align items and stretch card

                const isLab = item.category === "AI Lab";
                const isInactive = item.category === "Inactive";

                let safetyLinksHTML = '';
                if (item.safetyLinks && item.safetyLinks.length > 0) {
                    safetyLinksHTML = `
                        <div class="safety-links pt-2"> <!-- Removed mt-auto, handled by flex grow on desc -->
                            ${item.safetyLinks.map(link => `
                                <a href="${link.url}" target="_blank" rel="noopener noreferrer" title="${link.title || link.text}">
                                    <i class="${link.icon || 'bi-link-45deg'}"></i>${link.text}
                                </a>
                            `).join('')}
                        </div>`;
                }

                 // *** UPDATED: Use subCategoryIcon/Text with fallbacks ***
                 // Fallback chain: Use item.subCategoryIcon if available, otherwise use the main category icon,
                 // otherwise use a generic 'info' icon as the final fallback.
                 const subIcon = item.subCategoryIcon || categoryIcons[item.category] || 'bi-info-circle';
                 // Fallback: Use item.subCategoryText if available, otherwise use the main category name.
                 const subText = item.subCategoryText || item.category;

                col.innerHTML = `
                    <div class="card flex-fill ${isInactive ? 'inactive-card' : ''}" id="${item.cardId}">
                        <div class="card-body d-flex flex-column"> <!-- Flex column for card body -->
                            ${isLab ? `
                                <div class="title-logo-container">
                                    <h5 class="card-title mb-0">
                                        <a href="${item.url}" target="_blank" rel="noopener noreferrer" title="Visit the ${item.name} website">${item.name}</a>
                                        <span class="badge importance-badge imp-${item.importance}" title="Importance Score: ${item.importance}">${item.importance}</span>
                                    </h5>
                                    ${item.logoUrl ? `<img src="${item.logoUrl}" alt="${item.name} Logo" class="ai-lab-logo">` : ''}
                                </div>
                            ` : `
                                <h5 class="card-title">
                                    <a href="${item.url}" target="_blank" rel="noopener noreferrer" title="Visit the ${item.name} website">${item.name}</a>
                                    <span class="badge importance-badge imp-${item.importance}" title="Importance Score: ${item.importance}">${item.importance}</span>
                                </h5>
                            `}
                            <div class="category-info">
                                <i class="${subIcon} category-icon" title="${item.category}"></i> <!-- Title attribute still shows main category for context -->
                                <span class="category-text">${subText}</span> <!-- Display subcategory text or main category name -->
                            </div>
                            <p class="card-text flex-grow-1">${item.description}</p> <!-- Allow description to grow -->
                            ${safetyLinksHTML} <!-- Safety links will be pushed down by description growth -->
                        </div>
                    </div>
                `;
                row.appendChild(col);
            });

            container.appendChild(section);
            // Add divider logic
             const nextCategoryIndex = categoryOrder.indexOf(category) + 1;
             const nextPopulatedCategory = categoryOrder.slice(nextCategoryIndex).find(cat => data.some(d => d.category === cat));
             if (nextPopulatedCategory && category !== "Inactive") { // Don't add divider after last real category
                  const divider = document.createElement('hr');
                  divider.className = 'my-4'; // Bootstrap margin utility
                  container.appendChild(divider);
             }
        });
    }

    function renderMapView(data) {
        mapRendered = true; // Mark map as rendered
        const mapContainer = document.getElementById('map-container');
        const svg = d3.select("#map-svg");
        svg.selectAll("*").remove(); // Clear previous map elements

        let width = mapContainer.clientWidth;
        let height = mapContainer.clientHeight;
        if (width <= 0 || height <= 0) {
            console.warn("Map container has zero dimensions. Map rendering aborted.");
            d3.select(mapContainer).html('<p class="text-muted text-center p-5">Map cannot be displayed (container not visible or has no size).</p>');
            return;
        }

        const defs = svg.append("defs");
        // Add Filters (same as before)
        defs.html(`
            <filter id="drop-shadow" x="-50%" y="-50%" width="200%" height="200%"> <feGaussianBlur in="SourceAlpha" stdDeviation="2" result="blur"/> <feOffset in="blur" dx="2" dy="2" result="offsetBlur"/> <feFlood flood-color="#333" flood-opacity="0.4" result="offsetColor"/> <feComposite in="offsetColor" in2="offsetBlur" operator="in" result="offsetBlurColored"/> <feMerge> <feMergeNode in="offsetBlurColored"/> <feMergeNode in="SourceGraphic"/> </feMerge> </filter>
            <filter id="drop-shadow-selected" x="-50%" y="-50%" width="200%" height="200%"> <feGaussianBlur in="SourceAlpha" stdDeviation="3" result="blur"/> <feOffset in="blur" dx="3" dy="3" result="offsetBlur"/> <feFlood flood-color="#000" flood-opacity="0.5" result="offsetColor"/> <feComposite in="offsetColor" in2="offsetBlur" operator="in" result="offsetBlurColored"/> <feMerge> <feMergeNode in="offsetBlurColored"/> <feMergeNode in="SourceGraphic"/> </feMerge> </filter>
        `);
        const mainGroup = svg.append("g");
        const tooltip = d3.select("#tooltip");

        if (!data || data.length === 0) {
            console.warn("No data available for map view.");
            d3.select(mapContainer).html('<p class="text-muted text-center p-5">No data to display in map view.</p>');
            return;
        }

        const categories = categoryOrder.filter(cat => data.some(d => d.category === cat));
        const colorScale = d3.scaleOrdinal().domain(categories).range(categories.map(cat => categoryColors[cat] || '#ccc'));

        // --- Size Scale based on Importance ---
        // Importance 5 (most important) -> largest size (e.g., 25)
        // Importance 1 (least important) -> smallest size (e.g., 8)
        const sizeScale = d3.scaleSqrt()
                            .domain([1, 5]) // Input: Importance score
                            .range([8, 25]); // Output: Radius (small to large)


        // Define Category Cluster Centers (logic moved to handleResize to be calculated dynamically)
        // Calculate initial centers immediately if map is visible
        if (mapContainer.clientWidth > 0 && mapContainer.clientHeight > 0) {
            calculateClusterCenters(width, height, categories);
        }


        // Create Radial Gradients (same as before)
        categories.forEach(category => {
             const baseColor = d3.color(colorScale(category));
             if (!baseColor) return;
             const gradientId = `grad-${category.replace(/[\/\s]+/g, '-')}`;
             const radialGradient = defs.append("radialGradient").attr("id", gradientId);
             radialGradient.append("stop").attr("offset", "0%").attr("stop-color", baseColor.brighter(1.5));
             radialGradient.append("stop").attr("offset", "100%").attr("stop-color", baseColor.darker(0.5));
        });
        // Add default gradient for potential 'Inactive' or uncategorized
        const inactiveColor = categoryColors['Inactive'] || '#cccccc';
        const inactiveGradientId = `grad-Inactive`;
        if(!defs.select(`#${inactiveGradientId}`).node()){ // Add only if not already added
             const inactiveRadialGradient = defs.append("radialGradient").attr("id", inactiveGradientId);
             inactiveRadialGradient.append("stop").attr("offset", "0%").attr("stop-color", d3.color(inactiveColor).brighter(1));
             inactiveRadialGradient.append("stop").attr("offset", "100%").attr("stop-color", d3.color(inactiveColor).darker(0.5));
         }


        // Force Simulation with Clustering
        const simulation = d3.forceSimulation(data)
            .force("charge", d3.forceManyBody().strength(-100)) // Adjusted strength
             // Collision radius depends on size scale
            .force("collide", d3.forceCollide().radius(d => sizeScale(d.importance) + 5).strength(0.7)) // Adjusted strength
            .force("center", d3.forceCenter(width / 2, height / 2).strength(0.02)) // Low center strength
            .force("x", d3.forceX(d => categoryCenters[d.category || 'Inactive']?.x ?? width / 2).strength(0.08)) // Cluster X
            .force("y", d3.forceY(d => categoryCenters[d.category || 'Inactive']?.y ?? height / 2).strength(0.08)) // Cluster Y
            .on("tick", ticked);


        // Drawing Elements
        let node = mainGroup.selectAll(".node")
            .data(data, d => d.id)
            .join("g")
              .attr("class", "node")
              .attr("cursor", "pointer")
              .call(drag(simulation));

        node.append("circle")
            .attr("r", d => sizeScale(d.importance))
            .attr("fill", d => `url(#grad-${(d.category || 'Inactive').replace(/[\/\s]+/g, '-')})`);

        // Add Icon Text
        node.append("text")
            .attr("class", d => `node-icon ${d.icon || 'bi-question-circle'}`)
            .attr("dy", "0.1em") // Small vertical adjustment for centering
            // Icon size can optionally scale slightly with importance
            .style("font-size", d => `${Math.max(10, 6 + (d.importance*1.5))}px`) // Example: 1->7.5px, 5->13.5px (adjust multiplier)
            .text(d => {
                 // Use the main category icon from the `icon` property added during data processing
                 // Map icon class name to Unicode character using Bootstrap Icons cheatsheet/font
                 switch(d.icon) {
                    case 'bi-robot': return '\uf6ec';
                    case 'bi-mortarboard-fill': return '\uf447';
                    case 'bi-building-gear': return '\ue124';
                    case 'bi-megaphone-fill': return '\uf49a';
                    case 'bi-broadcast-pin': return '\ue120';
                    case 'bi-cash-stack': return '\uf240';
                    case 'bi-person-workspace': return '\uf4e2';
                    case 'bi-diagram-3-fill': return '\uf305';
                    case 'bi-graph-up-arrow': return '\ue3f0';
                    case 'bi-slash-circle-fill': return '\uf582';
                    case 'bi-question-circle': return '\uf518'; // Default icon
                    default: return '\uf518'; // question-circle
                }
            });

        // Add Label Text
        node.append("text")
            .attr("class", "node-label")
            .text(d => d.name || "Unknown")
             // Label offset uses the size scale
            .attr("dy", d => sizeScale(d.importance) + 10) // Position below circle
            .style("display", "none"); // Initially hidden, shown on zoom


        // --- Interactivity (Click, Hover, Tooltip, Info Panel - same as before) ---
        const infoPanel = d3.select("#info-panel");
        const infoName = d3.select("#info-name");
        const infoCategory = d3.select("#info-category");
        const infoImportance = d3.select("#info-importance");
        const infoDescription = d3.select("#info-description");
        const infoLink = d3.select("#info-link");
        const infoSafetyLinks = d3.select("#info-safety-links");

        node.on("click", (event, d) => {
            event.stopPropagation();
            node.classed("selected", n => n && n.id === d.id); // Check n exists
            showInfo(d);
            tooltip.style("opacity", 0);
        });
        svg.on("click", () => {
            node.classed("selected", false);
            infoPanel.style("display", "none");
            tooltip.style("opacity", 0);
        });

        node.on("mouseover", (event, d) => {
            if (d3.select(event.currentTarget).classed("selected")) return;
            tooltip.style("opacity", 1)
                   .html(`
                       <strong>${d.name || 'N/A'}</strong>
                       <div class="tooltip-details">${d.category || 'N/A'} | Imp: ${d.importance || 'N/A'}</div>
                       <div class="tooltip-desc">${d.description || 'No description.'}</div>
                   `);
        })
        .on("mousemove", (event) => {
             const [svgX, svgY] = d3.pointer(event, document.body);
             const tipRect = tooltip.node().getBoundingClientRect();
             let x = svgX + 15;
             let y = svgY + 15;
             // Keep tooltip within viewport bounds
             const margin = 5; // Small margin from edge
             if (x + tipRect.width > window.innerWidth - margin) x = svgX - tipRect.width - 15;
             if (y + tipRect.height > window.innerHeight - margin) y = svgY - tipRect.height - 15;
             if (x < margin) x = margin;
             if (y < margin) y = margin;
             tooltip.style("left", `${x}px`).style("top", `${y}px`);
         })
        .on("mouseout", () => {
            tooltip.style("opacity", 0);
        });

        function showInfo(d) {
            if (!d) return; // Safety check
            infoName.text(d.name || "N/A");
            infoCategory.text(d.category || "N/A");
            infoImportance.html(`<span class="badge imp-${d.importance}">${d.importance || 'N/A'}</span>`);
            infoDescription.text(d.description || "No description available.");
            infoLink.attr("href", d.url).style("display", d.url ? "inline-block" : "none");
            if (d.url) { infoLink.attr("href", d.url); }

             infoSafetyLinks.html('');
             if (d.safetyLinks && d.safetyLinks.length > 0) {
                 infoSafetyLinks.append('h6').text('Safety Links:');
                 d.safetyLinks.forEach(link => {
                     infoSafetyLinks.append('a')
                         .attr('href', link.url)
                         .attr('target', '_blank')
                         .attr('rel', 'noopener noreferrer')
                         .attr('title', link.title || link.text)
                         .html(`<i class="${link.icon || 'bi-link-45deg'}"></i> ${link.text}`);
                 });
             }
            infoPanel.style("display", "block");
        }

        function ticked() {
            node.attr("transform", d => {
                 // Optional: Add boundary constraints if nodes escape view greatly
                 const radius = sizeScale(d.importance);
                 d.x = Math.max(radius + 10, Math.min(width - radius - 10, d.x)); // Add margin
                 d.y = Math.max(radius + 10, Math.min(height - radius - 10, d.y)); // Add margin
                 return `translate(${d.x},${d.y})`
             });
        }

        // Drag behavior
        function drag(simulation) {
          function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
            tooltip.style("opacity", 0);
            d3.select(this).raise(); // Bring dragged node to front
          }
          function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
          }
          function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            // Keep node fixed if it was selected, otherwise release
             if (!d3.select(this).classed('selected')) {
                 d.fx = null;
                 d.fy = null;
             }
          }
          return d3.drag().on("start", dragstarted).on("drag", dragged).on("end", dragended);
        }

        // Zoom behavior
        const zoom = d3.zoom()
            .scaleExtent([0.15, 6]) // Adjusted zoom range
            .on("zoom", (event) => {
                mainGroup.attr("transform", event.transform);
                tooltip.style("opacity", 0);
                // Show labels only when zoomed in sufficiently
                const k = event.transform.k;
                node.selectAll(".node-label").style("display", k > 0.7 ? null : "none");
            });
        svg.call(zoom);
        // Maybe set initial zoom slightly out? Optional.
        // svg.call(zoom.transform, d3.zoomIdentity.translate(width * 0.1, height * 0.1).scale(0.8));


        // --- Filtering & Legend (same as before) ---
        const filterContainer = d3.select("#filter-controls");
        filterContainer.html('');
        categories.forEach(category => {
             const filterId = `filter-${category.replace(/[\/\s]+/g, '-')}`;
             filterContainer.append("div")
                 .attr("class", "form-check")
                 .html(`<input class="form-check-input category-filter" type="checkbox" value="${category}" id="${filterId}" checked>
                        <label class="form-check-label" for="${filterId}">${category}</label>`);
         });
        d3.selectAll(".category-filter").on("change", updateFilters);

        const legendContainer = d3.select("#legend");
        legendContainer.html('');
        categories.forEach(category => {
             const iconClass = categoryIcons[category] || 'bi-question-circle';
             // Get the Unicode character for the icon (using the same switch as for node icons)
             let iconChar = '';
             switch(iconClass) {
                 case 'bi-robot': iconChar = '\uf6ec'; break;
                 case 'bi-mortarboard-fill': iconChar = '\uf447'; break;
                 case 'bi-building-gear': iconChar = '\ue124'; break;
                 case 'bi-megaphone-fill': iconChar = '\uf49a'; break;
                 case 'bi-broadcast-pin': iconChar = '\ue120'; break;
                 case 'bi-cash-stack': iconChar = '\uf240'; break;
                 case 'bi-person-workspace': iconChar = '\uf4e2'; break;
                 case 'bi-diagram-3-fill': iconChar = '\uf305'; break;
                 case 'bi-graph-up-arrow': iconChar = '\ue3f0'; break;
                 case 'bi-slash-circle-fill': iconChar = '\uf582'; break;
                 case 'bi-question-circle': iconChar = '\uf518'; break;
                 default: iconChar = '\uf518';
             }

             legendContainer.append("div")
                 .attr("class", "legend-item")
                 // Use the iconChar inside the box
                 .html(`<span class="legend-color-box" style="background-color: ${colorScale(category)};">
                            <i style="font-family: 'bootstrap-icons'; font-style: normal; font-weight: normal; speak: none; display: inline-block; text-decoration: inherit; width: 1em; height: 1em; text-align: center; font-variant: normal; text-transform: none; line-height: 1em; vertical-align: -0.125em; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; font-size: 10px; color: rgba(0, 0, 0, 0.6); text-shadow: 0 0 1px rgba(255,255,255,0.5);">${iconChar}</i>
                        </span>
                        <span>${category}</span>`);
        });

        function updateFilters() {
            const selectedCategories = new Set();
            d3.selectAll(".category-filter:checked").each(function() {
                selectedCategories.add(this.value);
            });
            node.style("display", d => selectedCategories.has(d.category) ? null : "none");

            // Hide info panel if its node's category is deselected
            if (infoPanel.style("display") === "block") {
                const selectedNode = d3.select(".node.selected");
                if (!selectedNode.empty()) {
                    const selectedNodeData = selectedNode.datum();
                     if (selectedNodeData && !selectedCategories.has(selectedNodeData.category)) {
                        selectedNode.classed("selected", false); // Deselect node visually
                        infoPanel.style("display", "none"); // Hide panel
                    }
                }
            }
            // Briefly reheat simulation if filters change to adjust layout slightly
             if(simulation) simulation.alpha(0.1).restart();
         }

        // --- Resize Handling ---
        let resizeTimer;
        function handleResize() {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                const currentWidth = mapContainer.clientWidth;
                const currentHeight = mapContainer.clientHeight;
                // Only resize if map is rendered and container has valid dimensions
                if (currentWidth <= 0 || currentHeight <= 0 || !mapRendered) return;

                width = currentWidth;
                height = currentHeight;

                // Recalculate cluster centers on resize
                calculateClusterCenters(width, height, categories);

                if (data && data.length > 0 && simulation) { // Check simulation exists
                    svg.attr("width", width).attr("height", height);
                    // Update forces that depend on width/height
                    simulation.force("center", d3.forceCenter(width / 2, height / 2).strength(0.02));
                    simulation.force("x").x(d => categoryCenters[d.category || 'Inactive']?.x ?? width / 2);
                    simulation.force("y").y(d => categoryCenters[d.category || 'Inactive']?.y ?? height / 2);

                    simulation.alpha(0.3).restart(); // Reheat simulation
                }
            }, 250);
        }
        window.addEventListener('resize', handleResize);
        // Call handleResize once initially IF the map tab is active
        // Moved this logic to DOMContentLoaded where dataLoaded is checked
    }

    // --- Helper Function for Cluster Centers ---
    function calculateClusterCenters(w, h, cats) {
         const numCategories = cats.filter(c => c !== 'Inactive').length; // Don't count inactive for positioning
         // Simple circular arrangement - adjust as needed (grid, ellipse etc.)
         const clusterRadiusX = Math.min(w, h) / 3.0; // Base radius on smaller dimension, adjust factor
         const clusterRadiusY = clusterRadiusX; // Keep it circular for now
         const angleStep = (2 * Math.PI) / Math.max(1, numCategories); // Avoid division by zero

         categoryCenters = cats.reduce((acc, category, i) => {
             if (category === 'Inactive') {
                 acc[category] = { x: w / 2, y: h / 2 + clusterRadiusY * 1.2 }; // Position Inactive below center
             } else {
                 // Calculate index excluding 'Inactive' if it exists before current cat
                 const activeIndex = cats.slice(0, i).filter(c => c !== 'Inactive').length;
                 acc[category] = {
                     x: w / 2 + clusterRadiusX * Math.cos(activeIndex * angleStep - Math.PI / 2), // Offset start angle (top)
                     y: h / 2 + clusterRadiusY * Math.sin(activeIndex * angleStep - Math.PI / 2)
                 };
             }
             return acc;
         }, {});
         // Ensure 'Inactive' always has a center defined, even if not in cats list initially
         if (!categoryCenters['Inactive']) {
             categoryCenters['Inactive'] = { x: w / 2, y: h / 2 + clusterRadiusY * 1.2 };
         }
     }


    // --- Initial Load ---
    document.addEventListener('DOMContentLoaded', () => {
        let dataLoaded = false;
        // Check if aiSafetyData was successfully created and has items
        if (typeof aiSafetyData !== 'undefined' && aiSafetyData && aiSafetyData.length > 0) {
             renderListView(aiSafetyData); // Render list view first
             dataLoaded = true;
        } else {
             const listContainer = document.getElementById('list-view-content');
             if (listContainer) {
                 listContainer.innerHTML = ''; // Clear spinner
                 if (typeof rawAiSafetyData === 'undefined') {
                     listContainer.innerHTML = '<p class="text-danger text-center">Error: Could not load data from data.js.</p>';
                 } else {
                    listContainer.innerHTML = '<p class="text-muted text-center">No AI Safety data available.</p>';
                 }
             }
             console.error("AI Safety Data is missing, empty, or could not be processed.");
         }

         const mapTabEl = document.getElementById('map-tab');
         const mapPaneEl = document.getElementById('map-view-pane');

         // Initial render if map tab is active *and* data loaded
         if (mapTabEl && mapPaneEl && mapPaneEl.classList.contains('active') && dataLoaded && !mapRendered) {
             // Need a slight delay for the tab pane dimensions to be calculated correctly sometimes
             setTimeout(() => {
                 renderMapView(aiSafetyData);
                 window.dispatchEvent(new Event('resize')); // Trigger resize calc after render
             }, 50);
         }

         // Add listener to render/resize map when its tab becomes visible
         if (mapTabEl) {
             mapTabEl.addEventListener('shown.bs.tab', function (event) {
                 // Render map if data is loaded but map hasn't been rendered yet
                 if(dataLoaded && !mapRendered) {
                      // Delay needed here too for dimensions
                      setTimeout(() => {
                         renderMapView(aiSafetyData);
                         window.dispatchEvent(new Event('resize')); // Trigger resize after initial render on tab show
                      }, 50);
                 } else if (mapRendered) {
                     // If already rendered, just ensure layout/centers/zoom are correct
                     window.dispatchEvent(new Event('resize'));
                 }
             });
         }

         // Add smooth scrolling for category nav links
         document.querySelectorAll('#category-nav a').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const targetId = this.getAttribute('href').substring(1); // Get ID without '#'
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    // Get the list pane element for scrolling
                    const listPane = document.getElementById('list-view-pane');
                    if (listPane) {
                        // Calculate position relative to the scrollable container
                        const offsetTop = targetElement.offsetTop - listPane.offsetTop;
                        // Add a small top margin/padding adjustment if needed (e.g., 10px)
                        const scrollPadding = 10;
                        listPane.scrollTo({
                            top: offsetTop - scrollPadding,
                            behavior: 'smooth'
                        });
                    }
                }
            });
        });
     });

    </script>
<footer class="container-fluid text-center text-muted pb-3">
<div class="mb-3">
<h6 style="
            color: var(--text-color-primary);
            font-family: var(--font-headings);
            font-size: 1rem;
            margin-bottom: 0.5rem;
          ">
          Explore Related AI Cheatsheets:
        </h6>
<a class="mx-2" href="https://cheatsheets.davidveksler.com/airisk.html" rel="noopener noreferrer" style="font-size: 0.9em" target="_blank" title="AI Existential Risk (X-Risk) Cheatsheet">
<i class="bi bi-shield-exclamation"></i> AI X-Risk
        </a>
<a class="mx-2" href="https://cheatsheets.davidveksler.com/ai-frontier.html" rel="noopener noreferrer" style="font-size: 0.9em" target="_blank" title="AI Frontier Model Builders Cheatsheet">
<i class="bi bi-cpu-fill"></i> AI Frontier Models
        </a>
<a class="mx-2" href="https://cheatsheets.davidveksler.com/aisafety.html" rel="noopener noreferrer" style="font-size: 0.9em" target="_blank" title="Interactive AI Safety Ecosystem Hub">
<i class="bi bi-diagram-3-fill"></i> AI Safety Ecosystem
        </a>
</div>
<div>
<a class="mx-2" href="https://www.linkedin.com/in/davidveksler/" target="_blank" title="David Veksler on LinkedIn">
<i class="bi bi-linkedin"></i> LinkedIn
        </a>
<a class="mx-2" href="https://cheatsheets.davidveksler.com/" title="Browse All Cheatsheets">
<i class="bi bi-collection-fill"></i> All Cheatsheets
        </a>
</div>
</footer>
</body>
</html>